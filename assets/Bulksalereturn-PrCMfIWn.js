import{r as c,M as C,j as e,V as f,W as m,X as D,Y as E,Z as H,_ as I,a0 as d,a1 as B,a2 as M,a3 as U,a4 as K,a5 as y,a6 as l,a8 as V,a7 as X}from"./index-2oI7w0HU.js";import{C as _}from"./CircularProgress-CVrM3Oia.js";import{D as Y}from"./Download-Ca7JEVS2.js";function G(){const[s,v]=c.useState({bill_number:"",fullname:"",phone_number:"",address:""}),[i,g]=c.useState([{barcode:"",category:"",sub_category:"",size:"",item_name:""}]),[n,u]=c.useState({add:!1,fetch:!1}),[R,j]=c.useState(!1),[b,k]=c.useState(null),[z,p]=c.useState(!1),[T,F]=c.useState([]);c.useEffect(()=>{N()},[]);const N=async()=>{u({...n,tableFetch:!0});try{const a=await C.get("api/salesreturn/returns/");if(a.data&&a.data.data){const t=a.data.data.flatMap(r=>r.items.map(o=>({return_id:r.return_id,item_name:o.item_name,barcode:o.barcode,category:o.category,sub_category:o.sub_category,size:o.size})));F(t)}}catch(a){console.error("Error fetching sales return data",a)}finally{u({...n,tableFetch:!1})}},x=a=>{v({...s,[a.target.name]:a.target.value})},h=(a,t,r)=>{const o=[...i];o[t][r]=a.target.value,g(o)},w=()=>{const a=i.filter((t,r)=>r!==b);g(a),alert("Item removed from the sales return list."),p(!1)},A=()=>{j(!0),k(null)},S=()=>{j(!1)},P=async()=>{const a=s.bill_number;if(a.length>0){u({...n,fetch:!0});try{const r=(await C.get(`/api/retailsale/orders/${a}/`)).data;v({bill_number:r.bill_number,fullname:r.fullname,phone_number:r.phone_number,address:r.address}),r.items&&g(r.items)}catch(t){console.error("Error fetching bill details",t),alert("Failed to fetch bill details.")}finally{u({...n,fetch:!1})}}else alert("Please enter a valid Bill Number.")},L=async a=>{if(a.preventDefault(),u({...n,add:!0}),!s.fullname||!s.phone_number||!s.address||!s.bill_number){alert("Please fill in all fields."),u({...n,add:!1});return}const t={bill_number:{full_name:s.fullname,phone_number:s.phone_number,address:s.address},items:i.map(r=>({barcode:r.barcode,category:r.category,sub_category:r.sub_category,size:r.size,item_name:r.item_name}))};try{const r=await C.post("api/salesreturn/salesreturn/",t);console.log("Sales return data sent successfully:",r.data);const o=r.data.data.return_id;g(O=>[...O,{...t,return_id:o,items:i}]),alert("Sales return processed successfully.")}catch(r){console.error("Error processing sales return",r),alert("Failed to process sales return.")}finally{u({...n,add:!1}),j(!1)}},W=()=>{alert("PDF generation is not implemented yet.")};return e.jsxs(f,{sx:{maxWidth:"100%",padding:2,overflow:"hidden"},children:[e.jsx(m,{variant:"contained",color:"secondary",onClick:A,children:b!==null?"Edit Item":"SALE RETURN"}),e.jsxs(D,{open:R,onClose:S,children:[e.jsx(E,{style:{backgroundColor:"#f9dff5"},children:b!==null?"Edit Bill Details":"Add Bill Details"}),e.jsx(H,{style:{backgroundColor:"#f9dff5"},children:e.jsx(I,{sx:{padding:"20px",backgroundColor:"#f9dff5"},elevation:0,children:e.jsxs("form",{children:[e.jsxs(f,{sx:{marginBottom:3},children:[e.jsx("h3",{children:"Customer Information"}),e.jsx(d,{fullWidth:!0,label:"Bill Number",name:"bill_number",value:s.bill_number,onChange:x,margin:"normal"}),e.jsx(m,{variant:"contained",color:"secondary",onClick:P,disabled:n.fetch,children:n.fetch?e.jsx(_,{size:24}):"CHECK HERE"}),e.jsxs(f,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2},children:[e.jsx(d,{label:"Full Name",name:"fullname",value:s.fullname,onChange:x,margin:"normal"}),e.jsx(d,{label:"Phone Number",name:"phone_number",value:s.phone_number,onChange:x,margin:"normal"})]}),e.jsx(d,{fullWidth:!0,label:"Address",name:"address",value:s.address,onChange:x,margin:"normal"})]}),e.jsxs(f,{sx:{marginBottom:3},children:[e.jsx("h3",{children:"Item Information"}),e.jsxs(f,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:2},children:[e.jsx(d,{label:"Barcode",value:i[0].barcode,onChange:a=>h(a,0,"barcode"),margin:"normal"}),e.jsx(d,{label:"Category",value:i[0].category,onChange:a=>h(a,0,"category"),margin:"normal"}),e.jsx(d,{label:"Sub Category",value:i[0].sub_category,onChange:a=>h(a,0,"sub_category"),margin:"normal"}),e.jsx(d,{label:"Size",value:i[0].size,onChange:a=>h(a,0,"size"),margin:"normal"})]}),e.jsx(d,{fullWidth:!0,label:"Item Name",value:i[0].item_name,onChange:a=>h(a,0,"item_name"),margin:"normal"})]})]})})}),e.jsxs(B,{style:{backgroundColor:"#f9dff5"},children:[e.jsx(m,{onClick:S,color:"error",children:"Cancel"}),e.jsx(m,{onClick:L,color:"secondary",disabled:n.add,children:n.add?e.jsx(_,{size:24}):b!==null?"Update":"Add"})]})]}),e.jsx(M,{component:I,sx:{marginTop:3,overflow:"hidden"},children:e.jsxs(U,{children:[e.jsx(K,{children:e.jsxs(y,{children:[e.jsx(l,{children:"Item Name"}),e.jsx(l,{children:"Barcode"}),e.jsx(l,{children:"Category"}),e.jsx(l,{children:"Sub Category"}),e.jsx(l,{children:"Size"}),e.jsx(l,{children:"Return Id"}),e.jsx(l,{children:e.jsx(V,{color:"primary",onClick:W,children:e.jsx(Y,{})})})]})}),e.jsx(X,{children:n.tableFetch?e.jsx(y,{children:e.jsx(l,{colSpan:7,align:"center",children:e.jsx(_,{})})}):T.map((a,t)=>e.jsxs(y,{children:[e.jsx(l,{children:a.item_name}),e.jsx(l,{children:a.barcode}),e.jsx(l,{children:a.category}),e.jsx(l,{children:a.sub_category}),e.jsx(l,{children:a.size}),e.jsx(l,{children:a.return_id||"N/A"})]},t))})]})}),e.jsxs(D,{open:z,onClose:()=>p(!1),children:[e.jsx(E,{children:"Confirm Delete"}),e.jsxs(B,{children:[e.jsx(m,{onClick:()=>p(!1),color:"secondary",children:"Cancel"}),e.jsx(m,{onClick:w,color:"error",children:"Confirm"})]})]})]})}export{G as default};
