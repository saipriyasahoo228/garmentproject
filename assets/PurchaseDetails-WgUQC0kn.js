import{a9 as Z,aa as ee,j as e,r as s,J as je,K as _,M as H,O as Q,Q as J,U as o,a5 as ye,a6 as ve,a7 as be,a8 as X,V as i,W as K,X as Ce,S as De,Y as Ie,Z as Re,_ as U,$ as n,a0 as Se,a1 as Y}from"./index-Cy6RXqrN.js";import{a as j}from"./auth-DxPXTuxr.js";import{A as Pe}from"./Alert-Bii4Ez7t.js";import{C as Te}from"./CircularProgress-BtXJA0gh.js";var F={},Ae=ee;Object.defineProperty(F,"__esModule",{value:!0});var te=F.default=void 0,qe=Ae(Z()),Ee=e;te=F.default=(0,qe.default)((0,Ee.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete");var V={},We=ee;Object.defineProperty(V,"__esModule",{value:!0});var ae=V.default=void 0,ke=We(Z()),Fe=e;ae=V.default=(0,ke.default)((0,Fe.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit");function Me(){const[m,y]=s.useState({party_name:"",address:"",item:""}),[w,ne]=s.useState([]),[B,L]=s.useState(!1),[v,S]=s.useState({voucher_number:"",voucher_date:""}),[h,b]=s.useState([]),[c,P]=s.useState({quantity:"",rate:"",discount_percentage:"",gst_percentage:"",discount_amount:0,taxable_amount:0,gst_amount:0,purchase_amount:0}),[re,T]=s.useState(!1),[M,p]=s.useState(""),[g,A]=s.useState(null),[se,C]=s.useState(!1),[q,E]=s.useState(null),oe=s.useRef(null),le=s.useRef(null),ie=s.useRef(null),ce=s.useRef(null),ue=s.useRef(null),de=s.useRef(null);s.useEffect(()=>{const t=async()=>{try{const r=await j.get("api/purchase/purchase-entry/");b(r.data.data)}catch(r){console.error("Error fetching data:",r)}};(async()=>{L(!0);try{const r=await j.get("/api/user/party/");ne(r.data.data)}catch{p("Failed to load parties")}finally{L(!1)}})(),t()},[]);const W=t=>{const{name:a,value:r}=t.target;if(a==="party_name"){const l=w.find(x=>x.party_name===r);l&&y({...m,party_name:l.party_name,address:l.address,item:l.item||""})}else y({...m,[a]:r})},N=t=>{const{name:a,value:r}=t.target;S({...v,[a]:r})},D=t=>{const{name:a,value:r}=t.target,l={...c,[a]:r},x=parseFloat(l.quantity)||0,k=parseFloat(l.rate)||0,I=x*k,R=parseFloat(l.discount_percentage)/100*I,f=I-R,u=parseFloat(l.gst_percentage)/100*f,d=f+u;P({...l,discount_amount:R||0,taxable_amount:f||0,gst_amount:u||0,purchase_amount:d||0})},me=async()=>{const{party_name:t,address:a,item:r}=m,{voucher_number:l,voucher_date:x}=v,{quantity:k,rate:I,discount_percentage:R,gst_percentage:f}=c;if(!t||!a||!l||!x||!k||!I||!R||!f||!r){p("Please fill in all fields.");return}const u={...c,party_name:t,address:a,item:r,voucher_number:l,voucher_date:x};console.log(JSON.stringify(u,null,2));try{let d;g!==null?d=await j.put(`api/purchase/purchase-entries/${u.party_name}/`,u):d=await j.post("api/purchase/purchase-entries/",u);const G=d.data;if(g!==null){const ge=h.map((fe,_e)=>_e===g?G:fe);b(ge),A(null)}else b([...h,G]);he()}catch(d){console.error("Error saving data:",d),p("Error saving data. Please try again.")}},he=()=>{y({party_name:"",address:"",item:""}),S({voucher_number:"",voucher_date:""}),P({quantity:"",rate:"",discount_percentage:"",gst_percentage:"",discount_amount:0,taxable_amount:0,gst_amount:0,purchase_amount:0}),T(!1),p("")},O=(t=null)=>{if(t!==null){const a=h[t];P({quantity:a.quantity,rate:a.rate,discount_percentage:a.discount_percentage,gst_percentage:a.gst_percentage,discount_amount:a.discount_amount,taxable_amount:a.taxable_amount,gst_amount:a.gst_amount,purchase_amount:a.purchase_amount}),y({party_name:a.party_name,address:a.address,item:a.item}),S({voucher_number:a.voucher_number,voucher_date:a.voucher_date}),A(t)}else A(null);T(!0)},$=()=>{T(!1),p("")},pe=t=>{E(t),C(!0)},z=()=>{C(!1),E(null)},xe=async()=>{if(q!==null){const t=h[q];try{await j.delete(`api/user/purchase-entries/${t.party_name}/`),b(h.filter((a,r)=>r!==q)),E(null),C(!1)}catch(a){console.error("Error deleting item:",a),p("Failed to delete the item. Please try again."),C(!1)}}};return e.jsxs(je,{sx:{maxWidth:"100%",padding:2},children:[e.jsx(_,{variant:"contained",color:"secondary",onClick:()=>O(),children:g!==null?"Edit Item":"Add Item"}),e.jsxs(H,{open:re,onClose:$,maxWidth:"md",fullWidth:!0,children:[e.jsx(Q,{style:{backgroundColor:"#f9dff5"},children:g!==null?"Edit Item":"Add Item"}),e.jsxs(J,{style:{backgroundColor:"#f9dff5"},children:[M&&e.jsx(Pe,{severity:"error",children:M}),e.jsxs(o,{container:!0,spacing:2,marginBottom:2,children:[e.jsx(o,{item:!0,xs:6,children:e.jsxs(ye,{fullWidth:!0,margin:"normal",children:[e.jsx(ve,{children:"Party Name"}),e.jsx(be,{value:m.party_name,onChange:W,label:"Party Name",name:"party_name",disabled:B,inputRef:oe,children:B?e.jsx(X,{disabled:!0,children:e.jsx(Te,{size:24})}):w.map(t=>e.jsx(X,{value:t.party_name,children:t.party_name},t.id))})]})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(i,{fullWidth:!0,label:"Address",name:"address",value:m.address,onChange:W,margin:"normal",inputRef:le})})]}),e.jsxs(o,{container:!0,spacing:2,marginBottom:2,children:[e.jsx(o,{item:!0,xs:6,children:e.jsx(i,{fullWidth:!0,label:"Item",name:"item",value:m.item,onChange:W,margin:"normal",inputRef:ie})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(i,{fullWidth:!0,label:"Voucher Number",name:"voucher_number",value:v.voucher_number,onChange:N,margin:"normal",inputRef:ce})})]}),e.jsxs(o,{container:!0,spacing:2,marginBottom:2,children:[e.jsx(o,{item:!0,xs:6,children:e.jsx(i,{fullWidth:!0,label:"Voucher Date",type:"date",name:"voucher_date",value:v.voucher_date,onChange:N,margin:"normal",InputLabelProps:{shrink:!0},inputRef:ue})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(i,{fullWidth:!0,label:"Quantity",name:"quantity",value:c.quantity,onChange:D,margin:"normal",inputRef:de})})]}),e.jsxs(o,{container:!0,spacing:2,marginBottom:2,children:[e.jsx(o,{item:!0,xs:6,children:e.jsx(i,{fullWidth:!0,label:"Rate",name:"rate",value:c.rate,onChange:D,margin:"normal"})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(i,{fullWidth:!0,label:"Discount (%)",name:"discount_percentage",value:c.discount_percentage,onChange:D,margin:"normal"})})]}),e.jsx(o,{container:!0,spacing:2,marginBottom:2,children:e.jsx(o,{item:!0,xs:6,children:e.jsx(i,{fullWidth:!0,label:"GST (%)",name:"gst_percentage",value:c.gst_percentage,onChange:D,margin:"normal"})})})]}),e.jsxs(K,{style:{backgroundColor:"#f9dff5"},children:[e.jsx(_,{onClick:me,color:"primary",children:"Save"}),e.jsx(_,{onClick:$,color:"primary",children:"Cancel"})]})]}),e.jsxs(H,{open:se,onClose:z,children:[e.jsx(Q,{children:"Confirm Deletion"}),e.jsx(J,{children:"Are you sure you want to delete this item?"}),e.jsxs(K,{children:[e.jsx(_,{onClick:z,color:"secondary",children:"Cancel"}),e.jsx(_,{onClick:xe,color:"error",children:"Confirm"})]})]}),e.jsx(Ce,{component:De,sx:{overflowX:"auto",marginTop:3},children:e.jsxs(Ie,{children:[e.jsx(Re,{children:e.jsxs(U,{children:[e.jsx(n,{children:"Party Name"}),e.jsx(n,{children:"Item"}),e.jsx(n,{children:"Voucher Number"}),e.jsx(n,{children:"Voucher Date"}),e.jsx(n,{children:"Quantity"}),e.jsx(n,{children:"Rate"}),e.jsx(n,{children:"Discount (%)"}),e.jsx(n,{children:"GST (%)"}),e.jsx(n,{children:"Discount Amount"}),e.jsx(n,{children:"Taxable Amount"}),e.jsx(n,{children:"GST Amount"}),e.jsx(n,{children:"Purchase Amount"}),e.jsx(n,{children:"Actions"})]})}),e.jsx(Se,{children:h.map((t,a)=>e.jsxs(U,{children:[e.jsx(n,{children:t.party_name}),e.jsx(n,{children:t.item}),e.jsx(n,{children:t.voucher_number}),e.jsx(n,{children:t.voucher_date}),e.jsx(n,{children:t.quantity}),e.jsx(n,{children:t.rate}),e.jsx(n,{children:t.discount_percentage}),e.jsx(n,{children:t.gst_percentage}),e.jsx(n,{children:t.discount_amount}),e.jsx(n,{children:t.taxable_amount}),e.jsx(n,{children:t.gst_amount}),e.jsx(n,{children:t.purchase_amount}),e.jsxs(n,{children:[e.jsx(Y,{color:"secondary",onClick:()=>O(a),children:e.jsx(ae,{})}),e.jsx(Y,{color:"error",onClick:()=>pe(a),children:e.jsx(te,{})})]})]},a))})]})})]})}export{Me as default};
