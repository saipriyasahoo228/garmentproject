import{r as l,j as e,S,U as c,V as w,W as R,X as I,Y as A,_ as D,ab as M,ac as V,ad as X,ae as T,$ as L,a0 as G,a1 as J,a2 as Q,a3 as P,a4 as r,a5 as Z,a6 as W,a7 as ee,a8 as ae}from"./index-BZMcyf3q.js";import{E as ne}from"./jspdf.plugin.autotable-C9DfOvjm.js";import{a as _}from"./auth-DxPXTuxr.js";import{D as te}from"./Download-CUn2nmwQ.js";import{C as le}from"./CircularProgress-DXBbcDw3.js";function ce(){const[t,f]=l.useState({start_date:"",end_date:"",status:!0,financial_year_name:"",description:""}),[o,h]=l.useState([]),[u,y]=l.useState({add:!1}),[O,x]=l.useState(!1),[i,C]=l.useState(null),[K,p]=l.useState(!1),[m,U]=l.useState(null),$=l.useRef(null),b=l.useRef(null),F=l.useRef(null),Y=l.useRef(null);l.useEffect(()=>{if(t.start_date&&t.end_date){const a=new Date(t.start_date).getFullYear(),n=new Date(t.end_date).getFullYear();f({...t,financial_year_name:`${a}-${n}`})}},[t.start_date,t.end_date]),l.useEffect(()=>{(async()=>{try{const n=await _.get("/api/user/financial-years/");h(n.data.data)}catch(n){console.error("Error fetching financial year data:",n)}finally{y({...u,fetch:!1})}})()},[]);const j=a=>{f({...t,[a.target.name]:a.target.value})},B=()=>{x(!0),C(null)},v=()=>{x(!1)},k=async a=>{a.preventDefault(),y({...u,add:!0});const n=i!==null?`/api/user/financial-years/${o[i].id}/`:"/api/user/financial-years/",d=i!==null?"put":"post";try{const s=await _({method:d,url:n,data:t});if(i!==null){const E=[...o];E[i]=s.data.data,h(E)}else h([...o,s.data.data]);console.log(i!==null?"Updated":"Added",s.data),alert(s.data.message),x(!1)}catch(s){console.error("Error saving financial year:",s)}finally{y({...u,add:!1})}f({start_date:"",end_date:"",status:!0,financial_year_name:"",description:""})},q=a=>{f(o[a]),C(a),x(!0)},N=a=>{U(a),p(!0)},z=async()=>{try{const a=o[m].id;await _.delete(`/api/user/financial-years/${a}`);const n=o.filter((d,s)=>s!==m);h(n),console.log("Deleted financial year at index",m),alert("Deleted financial year at index",m)}catch(a){console.error("Error deleting financial year:",a)}finally{p(!1)}},g=(a,n)=>{var d;if(a.key==="Enter"){a.preventDefault();const s=(d=n.current)==null?void 0:d.nextElementSibling;s?s.focus():k(a)}},H=()=>{const a=new ne;a.text("Financial Year Report",14,15),a.autoTable({startY:25,head:[["#","Financial Year Name","Start Date","End Date","Status","Description"]],body:o.map((n,d)=>[d+1,n.financial_year_name,n.start_date,n.end_date,n.status?"Active":"Inactive",n.description]),theme:"striped"}),a.save("Financial_Year_List.pdf")};return e.jsxs(S,{sx:{maxWidth:"100%",padding:2},children:[e.jsx(c,{variant:"contained",color:"secondary",onClick:B,children:i!==null?"Edit Financial Year":"Add Financial Year"}),e.jsx(S,{sx:{position:"absolute",top:65,right:60},children:e.jsx(c,{variant:"contained",startIcon:e.jsx(te,{}),onClick:H,sx:{backgroundColor:"#800080",color:"white","&:hover":{backgroundColor:"#6a006a"}},children:"Download PDF"})}),e.jsxs(w,{open:O,onClose:v,children:[e.jsx(R,{style:{backgroundColor:"#f9dff5"},children:i!==null?"Edit Financial Year":"Add Financial Year"}),e.jsx(I,{style:{backgroundColor:"#f9dff5"},children:e.jsx(A,{sx:{padding:"10px",backgroundColor:"#f9dff5"},elevation:0,children:e.jsxs("form",{children:[e.jsx(D,{fullWidth:!0,label:"Financial Year Start Date",name:"start_date",type:"date",InputLabelProps:{shrink:!0},value:t.start_date,onChange:j,margin:"normal",required:!0,inputRef:$,onKeyDown:a=>g(a,b)}),e.jsx(D,{fullWidth:!0,label:"Financial Year End Date",name:"end_date",type:"date",InputLabelProps:{shrink:!0},value:t.end_date,onChange:j,margin:"normal",required:!0,inputRef:b,onKeyDown:a=>g(a,F)}),e.jsxs(M,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(V,{children:"Status"}),e.jsxs(X,{value:t.status,name:"status",onChange:j,label:"Status",inputRef:F,onKeyDown:a=>g(a,Y),children:[e.jsx(T,{value:!0,children:"Active"}),e.jsx(T,{value:!1,children:"Inactive"})]})]}),e.jsx(D,{fullWidth:!0,label:"Financial Year Name",name:"financial_year_name",value:t.financial_year_name,InputProps:{readOnly:!0},margin:"normal"}),e.jsx(D,{fullWidth:!0,multiline:!0,rows:3,label:"Description",name:"description",value:t.description,onChange:j,margin:"normal",inputRef:Y,onKeyDown:a=>g(a,null)})]})})}),e.jsxs(L,{style:{backgroundColor:"#f9dff5"},children:[e.jsx(c,{onClick:v,color:"error",children:"Cancel"}),e.jsx(c,{onClick:k,color:"secondary",disabled:u.add,children:u.add?e.jsx(le,{size:24}):i!==null?"Update":"Add"})]})]}),e.jsx(G,{component:A,sx:{marginTop:3},children:e.jsxs(J,{children:[e.jsx(Q,{children:e.jsxs(P,{children:[e.jsx(r,{children:"Financial Year Name"}),e.jsx(r,{children:"Start Date"}),e.jsx(r,{children:"End Date"}),e.jsx(r,{children:"Status"}),e.jsx(r,{children:"Description"}),e.jsx(r,{children:"Actions"})]})}),e.jsx(Z,{children:o.map((a,n)=>e.jsxs(P,{children:[e.jsx(r,{children:a.financial_year_name}),e.jsx(r,{children:a.start_date}),e.jsx(r,{children:a.end_date}),e.jsx(r,{children:a.status?"Active":"Inactive"})," ",e.jsx(r,{children:a.description}),e.jsxs(r,{children:[e.jsx(W,{color:"secondary",onClick:()=>q(n),children:e.jsx(ee,{})}),e.jsx(W,{color:"error",onClick:()=>N(n),children:e.jsx(ae,{})})]})]},n))})]})}),e.jsxs(w,{open:K,onClose:()=>p(!1),children:[e.jsx(R,{children:"Delete Financial Year"}),e.jsx(I,{children:"Are you sure you want to delete this financial year?"}),e.jsxs(L,{children:[e.jsx(c,{onClick:()=>p(!1),color:"secondary",children:"Cancel"}),e.jsx(c,{onClick:z,color:"error",children:"Confirm"})]})]})]})}export{ce as default};
