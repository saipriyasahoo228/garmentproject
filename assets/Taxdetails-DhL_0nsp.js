import{r as s,j as e,S as F,U as x,V as k,W as E,X as v,Y as R,ab as z,ac as H,ad as M,ae as T,_ as w,$ as A,a0 as V,a1 as X,a2 as Y,a3 as I,a4 as l,a5 as J,a6 as L,a7 as Q,a8 as Z}from"./index-v4F5H99w.js";import{a as f}from"./auth-BpA-8A-v.js";import{C as ee}from"./CircularProgress-BJOO4fYM.js";function re(){const[t,p]=s.useState({tax_name:"",tax_percentage:"",description:""}),[r,u]=s.useState([]),[o,d]=s.useState({add:!1}),[G,h]=s.useState(!1),[c,j]=s.useState(null),[m,P]=s.useState(null),[N,g]=s.useState(!1),O=s.useRef(null),y=s.useRef(null),D=s.useRef(null);s.useEffect(()=>{(async()=>{try{d({...o,fetch:!0});const n=await f.get("/api/user/taxes/");u(n.data.data)}catch(n){console.error("Error fetching tax list",n)}finally{d({...o,fetch:!1})}})()},[]);const C=a=>{p({...t,[a.target.name]:a.target.value})},S=(a,n)=>{var i;a.key==="Enter"&&(a.preventDefault(),(i=n.current)==null||i.focus())},W=()=>{h(!0),j(null)},b=()=>{h(!1)},B=async a=>{if(a.preventDefault(),d({...o,add:!0}),!t.tax_name||!t.tax_percentage){alert("Tax Name and Tax Percentage are required."),d({...o,add:!1});return}try{if(c!==null){const n=await f.put(`/api/user/taxes/${r[c].id}/`,t),i=[...r];i[c]=t,u(i),console.log("Updated",t),alert(n.data.message)}else{const n=await f.post("/api/user/taxes/",t);u([...r,n.data]),console.log("Added",t),alert(n.data.message)}p({tax_name:"",tax_percentage:"",description:""}),j(null),h(!1)}catch(n){console.error("Error adding/updating tax",n)}finally{d({...o,add:!1})}},U=a=>{p(r[a]),j(a),h(!0)},q=a=>{P(a),g(!0)},K=async()=>{try{await f.delete(`/api/user/taxes/${r[m].id}`);const a=r.filter((n,i)=>i!==m);u(a),console.log("Deleted tax at index",m),ae%$%$,g(!1)}catch(a){console.error("Error deleting tax",a)}},_=()=>{g(!1)};return e.jsxs(F,{sx:{maxWidth:"100%",padding:2},children:[e.jsx(x,{variant:"contained",color:"secondary",onClick:W,children:c!==null?"Edit Tax":"Add Tax"}),e.jsxs(k,{open:G,onClose:b,children:[e.jsx(E,{style:{backgroundColor:"#f9dff5"},children:c!==null?"Edit Tax Details":"Add Tax Details"}),e.jsx(v,{style:{backgroundColor:"#f9dff5"},children:e.jsx(R,{sx:{padding:"10px",backgroundColor:"#f9dff5"},elevation:0,children:e.jsxs("form",{children:[e.jsxs(z,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(H,{children:"Tax Name"}),e.jsxs(M,{value:t.tax_name,name:"tax_name",onChange:C,label:"Tax Name",inputRef:O,onKeyDown:a=>S(a,y),children:[e.jsx(T,{value:"CGST",children:"CGST"}),e.jsx(T,{value:"SGST",children:"SGST"}),e.jsx(T,{value:"IGST",children:"IGST"})]})]}),e.jsx(w,{fullWidth:!0,label:"Tax Percentage",name:"tax_percentage",value:t.tax_percentage,onChange:C,margin:"normal",required:!0,inputRef:y,onKeyDown:a=>S(a,D)}),e.jsx(w,{fullWidth:!0,multiline:!0,rows:4,label:"Description",name:"description",value:t.description,onChange:C,margin:"normal",inputRef:D})]})})}),e.jsxs(A,{style:{backgroundColor:"#f9dff5"},children:[e.jsx(x,{onClick:b,color:"error",children:"Cancel"}),e.jsx(x,{onClick:B,color:"secondary",disabled:o.add,children:o.add?e.jsx(ee,{size:24}):c!==null?"Update":"Add"})]})]}),e.jsx(V,{component:R,sx:{marginTop:3},children:e.jsxs(X,{children:[e.jsx(Y,{children:e.jsxs(I,{children:[e.jsx(l,{children:"Tax Name"}),e.jsx(l,{children:"Tax Percentage"}),e.jsx(l,{children:"Description"}),e.jsx(l,{children:"Actions"})]})}),e.jsx(J,{children:(Array.isArray(r)?r:[]).map((a,n)=>e.jsxs(I,{children:[e.jsx(l,{children:a.tax_name}),e.jsx(l,{children:a.tax_percentage}),e.jsx(l,{children:a.description}),e.jsxs(l,{children:[e.jsx(L,{color:"secondary",onClick:()=>U(n),children:e.jsx(Q,{})}),e.jsx(L,{color:"error",onClick:()=>q(n),children:e.jsx(Z,{})})]})]},n))})]})}),e.jsxs(k,{open:N,onClose:_,children:[e.jsx(E,{children:"Confirm Delete"}),e.jsx(v,{children:"Are you sure you want to delete this tax entry?"}),e.jsxs(A,{children:[e.jsx(x,{onClick:_,color:"secondary",children:"Cancel"}),e.jsx(x,{onClick:K,color:"error",children:"Confirm"})]})]})]})}export{re as default};
