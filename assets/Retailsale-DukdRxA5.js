import{am as xe,an as ye,ao as ve,aq as be,r as g,au as je,ay as $e,j as t,az as _e,aw as we,ak as H,ap as me,ax as Se,g as Pe,aA as De,_ as he,ad as Q,ae as X,af as ee,ag as T,V as oe,a8 as le,$ as M,a0 as v,W as ce,aB as Me,aj as Ce,aC as Ie,a2 as Ne,a3 as Ae,a4 as Te,a5 as ue,a6 as U,a7 as Fe,M as G}from"./index-Dy87SfDR.js";import{C as Re}from"./Container-DcIQiiR4.js";import{S as Oe,P as Ee}from"./Send-CJ7tSHMq.js";function ke(o){return ye("MuiInputAdornment",o)}const pe=xe("MuiInputAdornment",["root","filled","standard","outlined","positionStart","positionEnd","disablePointerEvents","hiddenLabel","sizeSmall"]);var fe;const Ue=(o,b)=>{const{ownerState:x}=o;return[b.root,b[`position${me(x.position)}`],x.disablePointerEvents===!0&&b.disablePointerEvents,b[x.variant]]},We=o=>{const{classes:b,disablePointerEvents:x,hiddenLabel:_,position:F,size:A,variant:R}=o,O={root:["root",x&&"disablePointerEvents",F&&`position${me(F)}`,R,_&&"hiddenLabel",A&&`size${me(A)}`]};return Se(O,ke,b)},ze=ve("div",{name:"MuiInputAdornment",slot:"Root",overridesResolver:Ue})(be(({theme:o})=>({display:"flex",maxHeight:"2em",alignItems:"center",whiteSpace:"nowrap",color:(o.vars||o).palette.action.active,variants:[{props:{variant:"filled"},style:{[`&.${pe.positionStart}&:not(.${pe.hiddenLabel})`]:{marginTop:16}}},{props:{position:"start"},style:{marginRight:8}},{props:{position:"end"},style:{marginLeft:8}},{props:{disablePointerEvents:!0},style:{pointerEvents:"none"}}]}))),de=g.forwardRef(function(b,x){const _=je({props:b,name:"MuiInputAdornment"}),{children:F,className:A,component:R="div",disablePointerEvents:O=!1,disableTypography:z=!1,position:C,variant:L,...w}=_,B=$e()||{};let j=L;L&&B.variant,B&&!j&&(j=B.variant);const E={..._,hiddenLabel:B.hiddenLabel,size:B.size,disablePointerEvents:O,position:C,variant:j},J=We(E);return t.jsx(_e.Provider,{value:null,children:t.jsx(ze,{as:R,ownerState:E,className:we(J.root,A),ref:x,...w,children:typeof F=="string"&&!z?t.jsx(H,{color:"textSecondary",children:F}):t.jsxs(g.Fragment,{children:[C==="start"?fe||(fe=t.jsx("span",{className:"notranslate",children:"â€‹"})):null,F]})})})});var ge={exports:{}};(function(o,b){(function(x,_){o.exports=_()})(De,function(){var x=1e3,_=6e4,F=36e5,A="millisecond",R="second",O="minute",z="hour",C="day",L="week",w="month",B="quarter",j="year",E="date",J="Invalid Date",re=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,ie=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,se={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(u){var i=["th","st","nd","rd"],r=u%100;return"["+u+(i[(r-20)%10]||i[r]||i[0])+"]"}},te=function(u,i,r){var l=String(u);return!l||l.length>=i?u:""+Array(i+1-l.length).join(r)+u},S={s:te,z:function(u){var i=-u.utcOffset(),r=Math.abs(i),l=Math.floor(r/60),e=r%60;return(i<=0?"+":"-")+te(l,2,"0")+":"+te(e,2,"0")},m:function u(i,r){if(i.date()<r.date())return-u(r,i);var l=12*(r.year()-i.year())+(r.month()-i.month()),e=i.clone().add(l,w),a=r-e<0,n=i.clone().add(l+(a?-1:1),w);return+(-(l+(r-e)/(a?e-n:n-e))||0)},a:function(u){return u<0?Math.ceil(u)||0:Math.floor(u)},p:function(u){return{M:w,y:j,w:L,d:C,D:E,h:z,m:O,s:R,ms:A,Q:B}[u]||String(u||"").toLowerCase().replace(/s$/,"")},u:function(u){return u===void 0}},Y="en",f={};f[Y]=se;var I="$isDayjsObject",Z=function(u){return u instanceof k||!(!u||!u[I])},q=function u(i,r,l){var e;if(!i)return Y;if(typeof i=="string"){var a=i.toLowerCase();f[a]&&(e=a),r&&(f[a]=r,e=a);var n=i.split("-");if(!e&&n.length>1)return u(n[0])}else{var s=i.name;f[s]=i,e=s}return!l&&e&&(Y=e),e||!l&&Y},y=function(u,i){if(Z(u))return u.clone();var r=typeof i=="object"?i:{};return r.date=u,r.args=arguments,new k(r)},d=S;d.l=q,d.i=Z,d.w=function(u,i){return y(u,{locale:i.$L,utc:i.$u,x:i.$x,$offset:i.$offset})};var k=function(){function u(r){this.$L=q(r.locale,null,!0),this.parse(r),this.$x=this.$x||r.x||{},this[I]=!0}var i=u.prototype;return i.parse=function(r){this.$d=function(l){var e=l.date,a=l.utc;if(e===null)return new Date(NaN);if(d.u(e))return new Date;if(e instanceof Date)return new Date(e);if(typeof e=="string"&&!/Z$/i.test(e)){var n=e.match(re);if(n){var s=n[2]-1||0,c=(n[7]||"0").substring(0,3);return a?new Date(Date.UTC(n[1],s,n[3]||1,n[4]||0,n[5]||0,n[6]||0,c)):new Date(n[1],s,n[3]||1,n[4]||0,n[5]||0,n[6]||0,c)}}return new Date(e)}(r),this.init()},i.init=function(){var r=this.$d;this.$y=r.getFullYear(),this.$M=r.getMonth(),this.$D=r.getDate(),this.$W=r.getDay(),this.$H=r.getHours(),this.$m=r.getMinutes(),this.$s=r.getSeconds(),this.$ms=r.getMilliseconds()},i.$utils=function(){return d},i.isValid=function(){return this.$d.toString()!==J},i.isSame=function(r,l){var e=y(r);return this.startOf(l)<=e&&e<=this.endOf(l)},i.isAfter=function(r,l){return y(r)<this.startOf(l)},i.isBefore=function(r,l){return this.endOf(l)<y(r)},i.$g=function(r,l,e){return d.u(r)?this[l]:this.set(e,r)},i.unix=function(){return Math.floor(this.valueOf()/1e3)},i.valueOf=function(){return this.$d.getTime()},i.startOf=function(r,l){var e=this,a=!!d.u(l)||l,n=d.p(r),s=function(W,N){var K=d.w(e.$u?Date.UTC(e.$y,N,W):new Date(e.$y,N,W),e);return a?K:K.endOf(C)},c=function(W,N){return d.w(e.toDate()[W].apply(e.toDate("s"),(a?[0,0,0,0]:[23,59,59,999]).slice(N)),e)},m=this.$W,h=this.$M,p=this.$D,P="set"+(this.$u?"UTC":"");switch(n){case j:return a?s(1,0):s(31,11);case w:return a?s(1,h):s(0,h+1);case L:var $=this.$locale().weekStart||0,D=(m<$?m+7:m)-$;return s(a?p-D:p+(6-D),h);case C:case E:return c(P+"Hours",0);case z:return c(P+"Minutes",1);case O:return c(P+"Seconds",2);case R:return c(P+"Milliseconds",3);default:return this.clone()}},i.endOf=function(r){return this.startOf(r,!1)},i.$set=function(r,l){var e,a=d.p(r),n="set"+(this.$u?"UTC":""),s=(e={},e[C]=n+"Date",e[E]=n+"Date",e[w]=n+"Month",e[j]=n+"FullYear",e[z]=n+"Hours",e[O]=n+"Minutes",e[R]=n+"Seconds",e[A]=n+"Milliseconds",e)[a],c=a===C?this.$D+(l-this.$W):l;if(a===w||a===j){var m=this.clone().set(E,1);m.$d[s](c),m.init(),this.$d=m.set(E,Math.min(this.$D,m.daysInMonth())).$d}else s&&this.$d[s](c);return this.init(),this},i.set=function(r,l){return this.clone().$set(r,l)},i.get=function(r){return this[d.p(r)]()},i.add=function(r,l){var e,a=this;r=Number(r);var n=d.p(l),s=function(h){var p=y(a);return d.w(p.date(p.date()+Math.round(h*r)),a)};if(n===w)return this.set(w,this.$M+r);if(n===j)return this.set(j,this.$y+r);if(n===C)return s(1);if(n===L)return s(7);var c=(e={},e[O]=_,e[z]=F,e[R]=x,e)[n]||1,m=this.$d.getTime()+r*c;return d.w(m,this)},i.subtract=function(r,l){return this.add(-1*r,l)},i.format=function(r){var l=this,e=this.$locale();if(!this.isValid())return e.invalidDate||J;var a=r||"YYYY-MM-DDTHH:mm:ssZ",n=d.z(this),s=this.$H,c=this.$m,m=this.$M,h=e.weekdays,p=e.months,P=e.meridiem,$=function(N,K,V,ae){return N&&(N[K]||N(l,a))||V[K].slice(0,ae)},D=function(N){return d.s(s%12||12,N,"0")},W=P||function(N,K,V){var ae=N<12?"AM":"PM";return V?ae.toLowerCase():ae};return a.replace(ie,function(N,K){return K||function(V){switch(V){case"YY":return String(l.$y).slice(-2);case"YYYY":return d.s(l.$y,4,"0");case"M":return m+1;case"MM":return d.s(m+1,2,"0");case"MMM":return $(e.monthsShort,m,p,3);case"MMMM":return $(p,m);case"D":return l.$D;case"DD":return d.s(l.$D,2,"0");case"d":return String(l.$W);case"dd":return $(e.weekdaysMin,l.$W,h,2);case"ddd":return $(e.weekdaysShort,l.$W,h,3);case"dddd":return h[l.$W];case"H":return String(s);case"HH":return d.s(s,2,"0");case"h":return D(1);case"hh":return D(2);case"a":return W(s,c,!0);case"A":return W(s,c,!1);case"m":return String(c);case"mm":return d.s(c,2,"0");case"s":return String(l.$s);case"ss":return d.s(l.$s,2,"0");case"SSS":return d.s(l.$ms,3,"0");case"Z":return n}return null}(N)||n.replace(":","")})},i.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},i.diff=function(r,l,e){var a,n=this,s=d.p(l),c=y(r),m=(c.utcOffset()-this.utcOffset())*_,h=this-c,p=function(){return d.m(n,c)};switch(s){case j:a=p()/12;break;case w:a=p();break;case B:a=p()/3;break;case L:a=(h-m)/6048e5;break;case C:a=(h-m)/864e5;break;case z:a=h/F;break;case O:a=h/_;break;case R:a=h/x;break;default:a=h}return e?a:d.a(a)},i.daysInMonth=function(){return this.endOf(w).$D},i.$locale=function(){return f[this.$L]},i.locale=function(r,l){if(!r)return this.$L;var e=this.clone(),a=q(r,l,!0);return a&&(e.$L=a),e},i.clone=function(){return d.w(this.$d,this)},i.toDate=function(){return new Date(this.valueOf())},i.toJSON=function(){return this.isValid()?this.toISOString():null},i.toISOString=function(){return this.$d.toISOString()},i.toString=function(){return this.$d.toUTCString()},u}(),ne=k.prototype;return y.prototype=ne,[["$ms",A],["$s",R],["$m",O],["$H",z],["$W",C],["$M",w],["$y",j],["$D",E]].forEach(function(u){ne[u[1]]=function(i){return this.$g(i,u[0],u[1])}}),y.extend=function(u,i){return u.$i||(u(i,k,y),u.$i=!0),y},y.locale=q,y.isDayjs=Z,y.unix=function(u){return y(1e3*u)},y.en=f[Y],y.Ls=f,y.p={},y})})(ge);var Be=ge.exports;const Le=Pe(Be);function Ge(){const[o,b]=g.useState({fullName:"",number:"",address:"",tax:"",discount:"",totalPrice:"",paymentMethod1:"Cash",paymentMethod2:"UPI",amount1:"",amount2:"",saletype:"RetailSale",narration:""}),[x,_]=g.useState([{barcode:"",category:"",sub_category:"",size:"",item_name:"",unit:"1",unit_price:"0.00"}]),F=g.useRef(""),[A,R]=g.useState(!1);g.useState(null);const O=Le().format("YYYY-MM-DD HH:mm:ss"),[z,C]=g.useState(!1),[L,w]=g.useState(0),[B,j]=g.useState([]),[E,J]=g.useState([]),[re,ie]=g.useState(null),[se,te]=g.useState(!1),[S,Y]=g.useState([]),f=g.useRef([]);g.useEffect(()=>{console.log("ðŸ”„ Updated Preview Items:",S)},[S]);const I=e=>{const{name:a,value:n}=e.target;b(s=>{const c={...s,[a]:n};return a==="amount1"&&n!==""&&r(),c})};g.useEffect(()=>{(async()=>{try{const a=await G.get("api/user/taxes/");a.data&&Array.isArray(a.data.data)?j(a.data.data):(console.error("Unexpected API response:",a.data),j([]))}catch(a){console.error("Error fetching tax data:",a),j([])}})()},[]);const Z=async()=>{if(o.number.length<10){alert("Please enter a valid phone number");return}try{const e=await G.post("api/retailsale/phone/",{phone_number:o.number});e.data&&b(a=>({...a,fullName:e.data.fullname||"",address:e.data.address||""}))}catch(e){console.error("Error fetching data:",e),alert("Failed to fetch data")}};g.useEffect(()=>{(async()=>{var n;const a=x[x.length-1];if(!(!a||!a.barcode||a.barcode===F.current)){F.current=a.barcode;try{console.log("Fetching data for barcode:",a.barcode);const s=await G.get(`api/barcode/get-barcode-details/${a.barcode}/`);if(console.log("API Response:",s.data),(n=s.data)!=null&&n.item_details){const{item_name:c,item_price:m,category_name:h,sub_category:p,item_size:P}=s.data.item_details;_($=>$.map((D,W)=>W===$.length-1?{...D,item_name:c||D.item_name,unit_price:m||D.unit_price,category:h||D.category,sub_category:p||D.sub_category,size:P||D.size}:D))}}catch(s){console.error("Error fetching data:",s)}}})()},[x]),g.useEffect(()=>{const e=async()=>{try{if(S.length===0)return;const a=S.reduce((c,m)=>c+Number(m.total_item_price||0),0),n={grand_total:a,discount:o.discount?Number(o.discount):0,tax:o.tax?Number(o.tax):0};console.log("Sending request data:",n),b(c=>({...c,totalPrice:Number(parseFloat(a).toFixed(2))}));const s=await G.post("api/retailsale/calculate-total-price/",n);console.log("API Response:",s.data),s.data&&s.data.total_price!==void 0&&b(c=>({...c,totalPrice:Number(parseFloat(s.data.total_price).toFixed(2))}))}catch(a){console.error("Error fetching total price:",a)}};S.length>0&&e()},[S,o.tax,o.discount]);const q=async e=>{var n;if(e.preventDefault(),S.length===0){alert("No items added! Please add at least one item before submitting.");return}const a={fullname:o.fullName.trim(),phone_number:o.number.trim(),address:o.address.trim(),tax:parseFloat(o.tax).toFixed(2),tax_type:"SGST",discount:parseFloat(o.discount).toFixed(2),payment_method1:o.paymentMethod1.trim(),payment_method1_amount:parseFloat(o.amount1).toFixed(2),payment_method2:o.paymentMethod2.trim(),payment_method2_amount:parseFloat(o.amount2).toFixed(2),narration:o.narration.trim(),saletype:o.saletype.trim(),items:S.map(({barcode:s,category:c,sub_category:m,size:h,item_name:p,unit:P,unit_price:$})=>({barcode:(s==null?void 0:s.trim())||"",category:(c==null?void 0:c.trim())||"",sub_category:(m==null?void 0:m.trim())||"",size:(h==null?void 0:h.trim())||"",item_name:(p==null?void 0:p.trim())||"",unit:Number(P)||1,unit_price:$?parseFloat($).toFixed(2):"0.00"}))};try{const s=await G.post("api/retailsale/create-order/",a),c=((n=s.data)==null?void 0:n.bill_number)||null;ie(c),console.log("âœ… API Response:",JSON.stringify(s.data,null,2)),alert(`Form submitted successfully! Bill Number: ${c}`),b({fullName:"",number:"",address:"",tax:"",discount:"",totalPrice:"",paymentMethod1:"Cash",paymentMethod2:"UPI",amount1:"",amount2:"",saletype:"RetailSale",narration:""}),Y([]),_([{barcode:"",category:"",sub_category:"",size:"",item_name:"",unit:"1",unit_price:"0.00"}])}catch(s){console.error("âŒ Submission Error:",s.response?JSON.stringify(s.response.data,null,2):s.message),alert(`Submission failed: ${s.response?JSON.stringify(s.response.data):s.message}`)}},y=()=>{alert("Notification sent!")},d=(e,a)=>{if(e.key==="Enter"){e.preventDefault();const n=a+1;n<f.current.length&&f.current[n].focus()}},k=(e,a)=>{const{name:n,value:s}=a.target;_(c=>c.map((m,h)=>h===e?{...m,[n]:s}:m))},ne=()=>{if(x.length>0){const e=x[x.length-1];console.log("ðŸ“Œ Last item before adding:",e);const a=[];if(e.barcode||a.push("Barcode"),e.item_name||a.push("Item Name"),e.unit||a.push("Unit"),e.unit_price||a.push("Unit Price"),a.length>0){alert(`Please fill out the required fields: ${a.join(", ")}`);return}Y(n=>[...n,{barcode:e.barcode,item_name:e.item_name||"",category:e.category||"",sub_category:e.sub_category||"",size:e.size||"",unit:Number(e.unit)||1,unit_price:Number(e.unit_price).toFixed(2)||"0.00"}]),_([{barcode:"",category:"",sub_category:"",size:"",item_name:"",unit:"1",unit_price:"0.00"}])}else alert("No items to add.")};g.useEffect(()=>{console.log("âœ… Updated Preview Items:",S)},[S]);const u=()=>{const e=window.open("","","height=600,width=800"),a=new Date().toLocaleString(),n=parseFloat(o.unitPrice)||0,s=parseFloat(o.tax)||0,c=parseFloat(o.discount)||0,h=(parseFloat(o.unit)||0)*n,p=h*s/100,P=h+p,$=A?P*c/100:0,D=P-$,W=`
    <html>
    <head>
      <title>Retail Sale Invoice</title>
      <style>
        body { font-family: Arial, sans-serif; margin: 20px; padding: 0; color: blue; background-color: #f9f9f9; }
        hr { border: none; border-bottom: 2px solid blue; margin: 20px 0; }/
        .invoice-container { width: 100%; max-width: 600px; margin: auto; border: 1px solid #ccc; padding: 20px; background-color: #fff; }
        .header { text-align: center; padding: 20px 0; background-color: #4caf50; color: blue; }
        .header h1 { margin: 0; font-size: 24px; }
        .section { margin-bottom: 20px; }
        .section h2 { margin-bottom: 10px; font-size: 18px; color: #4caf50; }
        .section p { margin: 5px 0; font-size: 14px; }
        .table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        .table th, .table td { border: 1px solid #ddd; padding: 10px; font-size: 14px; }
        .table th { background-color: #f2f2f2; text-align: left; }
        .footer { text-align: center; padding: 20px 0; background-color: #4caf50; color: blue; font-size: 14px; }
        .footer p { margin: 0;}
        .flex-container { display: flex; justify-content: space-between; align-items: center; }
        .left-info { text-align: left; }
        .right-info { text-align: right; }
        .right-info p { margin: 0; }
        .pricing-row {
          display: flex;
          justify-content: space-between;
          margin-bottom: 10px;
          font-size: 14px;
        }
        .pricing-row span {
          padding: 0 10px;
        }
      </style>
    </head>
    <body>
      <div class="invoice-container">
        <div class="header">
          <h1>NAARI FASHIONS</h1>
          <h2>MARKET BUILDING UNIT-II</h2>
          <hr>
          <h2>GSTIN:21AXKPR9141G1ZD</h2>
          <br><br>
          <h4>Retail Invoice</h4>
        </div>

        <div class="section">
          <div class="flex-container">
            <div class="left-info">
              <p><strong>Full Name:</strong> ${o.fullName}</p>
              <p><strong>Number:</strong> ${o.number}</p>
            </div>
            <div class="right-info">
              <p><strong>Date:</strong> ${a}</p>
              <p><strong>Invoice Number:</strong> ${o.invoiceNumber||"N/A"}</p>
            </div>
          </div>
        </div>

        <div class="section">
          <h2>Item Information</h2>
          <table class="table">
            <tr>
              <th>Sl#</th>
              <th>Particulars</th>
              <th>Qty</th>
              <th>Amount</th>
            </tr>
            <tr>
              <td>1</td>
              <td>${o.itemName}</td>
              <td>${o.unit}</td>
              <td>â‚¹${P.toFixed(2)}</td> <!-- Updated to show total after tax -->
            </tr>
          </table>
        </div>

        <div class="section">
          <h2>Pricing and Tax</h2>
          <div class="pricing-row">
            <span>Total</span>
            <span>${o.unit}</span>
            <span>â‚¹ ${P.toFixed(2)}</span>
          </div>
          <!--<div class="pricing-row">
            <span>Tax:</span>
            <span>${s}%</span>
            <span>+â‚¹${p.toFixed(2)}</span>
          </div>-->
          ${A?`
            <div class="pricing-row">
              <span>Discount:</span>
              <span>${o.discount}%</span>
              <span>-â‚¹${$.toFixed(2)}</span>
            </div>`:""}
          <div class="pricing-row">
            <span><strong>Net Payable:</strong></span>
            <span><strong>â‚¹${D.toFixed(2)}</strong></span>
          </div>
        </div>

        <div class="section">
          <h2>Payment and Narration</h2>
          <p><strong>Payment Method1:</strong> ${o.paymentMethod1} â‚¹ ${o.paymentAmount1||0}</p>
          <p><strong>Payment Method2:</strong> ${o.paymentMethod2} â‚¹ ${o.paymentAmount2||0}</p>
          <p><strong>Narration:</strong> ${o.narration}</p>
        </div>
        <div class="section">
        <h6>Terms & Condition</h6>
        <hr>
        <ul>
        <li>No cash return</li>
        <li>No Exchange without Bill</li>
        <li>Exchange within 7 days</li>
        <li>No Exchange on Satureday and Sunday</li>
        <li>Exchange within 12 p.m to 4 p.m only</li>
        <li>No Colour Guarantee on any item</li>
        </ul>
        </div>

        <div class="footer">
          <p>Thank you visit again!</p>
        </div>
      </div>
    </body>
    </html>
  `;e.document.open(),e.document.write(W),e.document.close(),e.print()},i=async()=>{if(S.length===0){alert("No items to preview.");return}try{const e=S.map(({item_name:n,unit:s,unit_price:c})=>({item_name:n.trim(),unit:parseFloat(s)||1,unit_price:parseFloat(c)||0})),a=await G.post("api/retailsale/item-preview/",{items:e});console.log("âœ… API Response:",a.data),a.data&&a.data.created_items?(Y(n=>n.map((s,c)=>{var m,h,p;return{...s,unit:((m=a.data.created_items[c])==null?void 0:m.unit)||s.unit,unit_price:((h=a.data.created_items[c])==null?void 0:h.unit_price)||s.unit_price,total_item_price:((p=a.data.created_items[c])==null?void 0:p.total_item_price)||"0.00"}})),J(a.data.created_items.map((n,s)=>{var c;return{barcode:((c=S[s])==null?void 0:c.barcode)||"",item_name:n.item_name,unit:n.unit,unit_price:n.unit_price,total_item_price:n.total_item_price||"0.00"}})),w(a.data.grand_total||0),C(!0)):(console.error("ðŸš¨ Unexpected API Response Structure:",a.data),alert("Unexpected response format. Please check the API."))}catch(e){console.error("âŒ Error fetching preview:",e.response?e.response.data:e.message),alert(`Error: ${e.response?JSON.stringify(e.response.data):e.message}`)}},r=async()=>{if(o.totalPrice)try{const e=await G.post("api/retailsale/calculate-payment-amount2/",{total_price:o.totalPrice,payment_method1_amount:o.amount1||"0"}),a=parseFloat(e.data.payment_method2_amount).toFixed(2);b(n=>({...n,amount2:a}))}catch(e){console.error("Error calculating Payment Amount 2:",e)}};g.useEffect(()=>{r()},[o.totalPrice,o.amount1]);const l=()=>C(!1);return t.jsx(Re,{maxWidth:"lg",sx:{backgroundColor:"#f9dff5",position:"relative"},children:t.jsxs(he,{sx:{p:3,backgroundColor:"#f9dff5"},elevation:0,children:[t.jsx(H,{variant:"h5",gutterBottom:!0,align:"center",color:"secondary",children:"SALE MODULE"}),t.jsxs(H,{variant:"body2",color:"textSecondary",align:"center",children:["Sales Date & Time: ",O]}),t.jsxs(Q,{size:"small",sx:{minWidth:120},children:[t.jsx(X,{children:"Sale Type"}),t.jsxs(ee,{value:o.saletype,onChange:I,name:"saletype",label:"Sale Type",children:[t.jsx(T,{value:"RetailSale",children:"Retail Sale"}),t.jsx(T,{value:"BulkSale",children:"Bulk Sale"})]})]}),t.jsxs(oe,{sx:{position:"absolute",top:16,right:16,display:"flex",gap:1},children:[t.jsx(le,{onClick:y,sx:{color:"#370140"},children:t.jsx(Oe,{})}),t.jsx(le,{onClick:u,sx:{color:"#370140"},children:t.jsx(Ee,{})})]}),t.jsxs(oe,{component:"form",onSubmit:q,sx:{mt:2},children:[t.jsxs(M,{container:!0,spacing:2,children:[t.jsxs(M,{item:!0,xs:12,md:3,children:[x.map((e,a)=>t.jsxs(M,{container:!0,spacing:2,style:{marginTop:"0.7px"},children:[t.jsxs(H,{variant:"subtitle1",gutterBottom:!0,color:"textPrimary",children:["Item Information ",a+1]}),t.jsxs(M,{container:!0,spacing:2,alignItems:"center",children:[t.jsx(M,{item:!0,xs:6,children:t.jsx(v,{style:{width:"100%"},label:"Barcode",name:"barcode",value:e.barcode,onChange:n=>k(a,n),margin:"normal",variant:"outlined",inputRef:n=>f.current[0]=n,onKeyDown:n=>d(n,0)})}),t.jsx(M,{item:!0,xs:6,children:t.jsx(v,{style:{width:"100%"},label:"Item Name",name:"item_name",value:e.item_name,onChange:n=>k(a,n),margin:"normal",variant:"outlined"})})]}),t.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[t.jsx(v,{style:{width:"150px"},label:"Category",name:"category",value:e.category,onChange:n=>k(a,n),margin:"dense",variant:"outlined",inputRef:n=>f.current[2]=n,onKeyDown:n=>d(n,2)}),t.jsx(v,{style:{width:"120px"},label:"Sub-category",name:"sub_category",value:e.sub_category,onChange:n=>k(a,n),margin:"dense",variant:"outlined",inputRef:n=>f.current[3]=n,onKeyDown:n=>d(n,3)})]}),t.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[t.jsx(v,{style:{width:"150px"},label:"Size",name:"size",value:e.size,onChange:n=>k(a,n),margin:"dense",variant:"outlined",inputRef:n=>f.current[4]=n,onKeyDown:n=>d(n,4)}),t.jsx(v,{style:{width:"120px"},label:"Unit",name:"unit",value:e.unit,onChange:n=>k(a,n),margin:"dense",variant:"outlined",inputRef:n=>f.current[5]=n,onKeyDown:n=>d(n,5)})]}),t.jsx(v,{style:{width:"100%"},label:"Unit Price",name:"unit_price",value:e.unit_price,onChange:n=>k(a,n),margin:"normal",variant:"outlined",inputRef:n=>f.current[6]=n,onKeyDown:n=>d(n,6)}),a!==x.length-1&&t.jsx("hr",{style:{margin:"10px 0"}})]},a)),t.jsxs(M,{children:[t.jsx(ce,{variant:"contained",color:"secondary",onClick:ne,style:{marginTop:"20px",borderRadius:"50%",height:"60px",width:"60px",padding:0},children:t.jsx(Me,{style:{fontSize:"32px",fontWeight:"bold"}})}),t.jsx(ce,{variant:"outlined",color:"secondary",onClick:i,style:{marginTop:"20px",marginLeft:"20px"},children:"Preview"})]})]}),t.jsx(Ce,{open:z,onClose:l,children:t.jsxs(oe,{sx:{bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4,position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"600px",overflowY:"auto",maxHeight:"400px"},children:[t.jsxs(H,{variant:"h6",component:"h2",gutterBottom:!0,style:{color:"secondary"},children:["Preview Items",t.jsx(le,{onClick:l,style:{float:"right"},children:t.jsx(Ie,{})})]}),E.length===0?t.jsx(H,{variant:"body1",children:"No items added yet."}):t.jsx(Ne,{component:he,children:t.jsxs(Ae,{children:[t.jsx(Te,{children:t.jsxs(ue,{children:[t.jsx(U,{style:{color:"secondary"},children:"Sl.No"}),t.jsx(U,{style:{color:"secondary"},children:"Item Name"}),t.jsx(U,{style:{color:"secondary"},children:"Unit"}),t.jsx(U,{style:{color:"secondary"},children:"Unit Price"}),t.jsx(U,{style:{color:"secondary"},children:"Total Item Price"})]})}),t.jsxs(Fe,{children:[E.map((e,a)=>t.jsxs(ue,{children:[t.jsx(U,{style:{textAlign:"center",color:"secondary"},children:a+1}),t.jsx(U,{style:{textAlign:"center"},children:e.item_name}),t.jsx(U,{style:{textAlign:"center"},children:e.unit}),t.jsx(U,{style:{textAlign:"center"},children:parseFloat(e.unit_price).toFixed(2)}),t.jsx(U,{style:{textAlign:"center"},children:e.total_item_price})]},a)),t.jsxs(ue,{children:[t.jsx(U,{colSpan:4,align:"right",children:t.jsx("strong",{children:"Grand Total:"})}),t.jsx(U,{style:{textAlign:"center"},children:parseFloat(L).toFixed(2)})]})]})]})})]})}),t.jsxs(M,{item:!0,xs:12,md:3,children:[t.jsx(H,{variant:"subtitle1",gutterBottom:!0,color:"textPrimary",children:"Customer Information"}),t.jsx(v,{fullWidth:!0,label:"Number",name:"number",value:o.number,onChange:I,onBlur:Z,margin:"normal",type:"tel",variant:"outlined"}),t.jsx(v,{fullWidth:!0,label:"Full Name",name:"fullName",value:o.fullName,onChange:I,margin:"normal",variant:"outlined"}),t.jsx(v,{fullWidth:!0,multiline:!0,rows:4,label:"Address",name:"address",value:o.address,onChange:I,margin:"normal",variant:"outlined"}),t.jsx(v,{label:"Bill Number",name:"bill_number",value:se?"Generating Bill Number...":re||"",variant:"outlined",margin:"normal",style:{width:"200px",fontWeight:"bold"},InputProps:{readOnly:!0}})]}),t.jsxs(M,{item:!0,xs:12,md:3,children:[t.jsx(H,{variant:"subtitle1",gutterBottom:!0,color:"textPrimary",children:"Pricing and Tax"}),t.jsxs(Q,{fullWidth:!0,margin:"normal",variant:"outlined",children:[t.jsx(X,{children:"Tax Type"}),t.jsx(ee,{name:"taxType",value:o.taxType,onChange:I,label:"Tax Type",children:B.map(e=>t.jsx(T,{value:e.tax_name,children:e.tax_name},e.id))})]}),t.jsx(v,{fullWidth:!0,label:"Tax (%)",name:"tax",value:o.tax,onChange:I,margin:"normal",variant:"outlined",inputRef:e=>f.current[7]=e,onKeyDown:e=>d(e,7)}),t.jsxs(Q,{fullWidth:!0,margin:"normal",variant:"outlined",children:[t.jsx(X,{children:"Discount Applicable"}),t.jsxs(ee,{name:"isDiscountApplicable",value:A?"Yes":"No",onChange:e=>R(e.target.value==="Yes"),label:"Discount Applicable",children:[t.jsx(T,{value:"No",children:"No"}),t.jsx(T,{value:"Yes",children:"Yes"})]})]}),A&&t.jsx(v,{fullWidth:!0,label:"Discount (%)",name:"discount",value:o.discount,onChange:I,margin:"normal",type:"number",variant:"outlined",inputRef:e=>f.current[8]=e,onKeyDown:e=>d(e,8)}),t.jsx(v,{fullWidth:!0,label:"Total Price",name:"totalPrice",value:o.totalPrice,margin:"normal",InputProps:{readOnly:!0,startAdornment:t.jsx(de,{position:"start",children:"â‚¹"})},variant:"outlined",inputRef:e=>f.current[9]=e,onKeyDown:e=>d(e,9)})]}),t.jsxs(M,{item:!0,xs:12,md:3,children:[t.jsx(H,{variant:"subtitle1",gutterBottom:!0,color:"textPrimary",children:"Payment and Narration"}),t.jsxs(M,{container:!0,spacing:2,children:[t.jsx(M,{item:!0,xs:6,children:t.jsxs(Q,{fullWidth:!0,margin:"normal",variant:"outlined",children:[t.jsx(X,{children:"Payment Method 1"}),t.jsxs(ee,{name:"paymentMethod1",value:o.paymentMethod1,onChange:I,label:"Payment Method 1",children:[t.jsx(T,{value:"Cash",children:"Cash"}),t.jsx(T,{value:"Credit Card",children:"Credit Card"}),t.jsx(T,{value:"Debit Card",children:"Debit Card"}),t.jsx(T,{value:"UPI",children:"UPI"})]})]})}),t.jsx(M,{item:!0,xs:6,children:t.jsx(v,{fullWidth:!0,label:"Payment Amount 1",name:"amount1",value:o.amount1,onChange:I,margin:"normal",InputProps:{startAdornment:t.jsx(de,{position:"start",children:"â‚¹"})},variant:"outlined",inputRef:e=>f.current[10]=e,onKeyDown:e=>d(e,10)})}),t.jsx(M,{item:!0,xs:6,children:t.jsxs(Q,{fullWidth:!0,margin:"normal",variant:"outlined",children:[t.jsx(X,{children:"Payment Method 2"}),t.jsxs(ee,{name:"paymentMethod2",value:o.paymentMethod2,onChange:I,label:"Payment Method 2",children:[t.jsx(T,{value:"Cash",children:"Cash"}),t.jsx(T,{value:"Credit Card",children:"Credit Card"}),t.jsx(T,{value:"Debit Card",children:"Debit Card"}),t.jsx(T,{value:"UPI",children:"UPI"})]})]})}),t.jsx(M,{item:!0,xs:6,children:t.jsx(v,{fullWidth:!0,label:"Payment Amount 2",name:"amount2",value:o.amount2,margin:"normal",InputProps:{readOnly:!0,startAdornment:t.jsx(de,{position:"start",children:"â‚¹"})},variant:"outlined"})})]}),t.jsx(v,{fullWidth:!0,multiline:!0,rows:4,label:"Narration",name:"narration",value:o.narration,onChange:I,margin:"normal",variant:"outlined",inputRef:e=>f.current[12]=e,onKeyDown:e=>d(e,12)})]})]}),t.jsx(ce,{type:"submit",variant:"contained",color:"secondary",fullWidth:!0,sx:{mt:2},children:"Submit"})]})]})})}export{Ge as default};
