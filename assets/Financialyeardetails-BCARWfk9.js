import{r as l,j as e,J as N,K as u,M as S,O as R,Q as w,S as I,V as g,a5 as z,a6 as H,a7 as J,a8 as A,W as T,X as Q,Y as V,Z as X,_ as L,$ as s,a0 as Z,a1 as O,a2 as G,a3 as ee}from"./index-LAyZdBLn.js";import{a as D}from"./auth-DxPXTuxr.js";import{C as ae}from"./CircularProgress-ClLnXta-.js";function se(){const[t,f]=l.useState({start_date:"",end_date:"",status:!0,financial_year_name:"",description:""}),[d,h]=l.useState([]),[o,C]=l.useState({add:!1}),[W,x]=l.useState(!1),[i,_]=l.useState(null),[K,p]=l.useState(!1),[j,P]=l.useState(null),$=l.useRef(null),Y=l.useRef(null),b=l.useRef(null),F=l.useRef(null);l.useEffect(()=>{if(t.start_date&&t.end_date){const a=new Date(t.start_date).getFullYear(),n=new Date(t.end_date).getFullYear();f({...t,financial_year_name:`${a}-${n}`})}},[t.start_date,t.end_date]),l.useEffect(()=>{(async()=>{try{const n=await D.get("/api/user/financial-years/");h(n.data.data)}catch(n){console.error("Error fetching financial year data:",n)}finally{C({...o,fetch:!1})}})()},[]);const m=a=>{f({...t,[a.target.name]:a.target.value})},B=()=>{x(!0),_(null)},v=()=>{x(!1)},E=async a=>{a.preventDefault(),C({...o,add:!0});const n=i!==null?`/api/user/financial-years/${d[i].id}/`:"/api/user/financial-years/",c=i!==null?"put":"post";try{const r=await D({method:c,url:n,data:t});if(i!==null){const k=[...d];k[i]=r.data.data,h(k)}else h([...d,r.data.data]);console.log(i!==null?"Updated":"Added",r.data),alert(r.data.message),x(!1)}catch(r){console.error("Error saving financial year:",r)}finally{C({...o,add:!1})}f({start_date:"",end_date:"",status:!0,financial_year_name:"",description:""})},U=a=>{f(d[a]),_(a),x(!0)},q=a=>{P(a),p(!0)},M=async()=>{try{const a=d[j].id;await D.delete(`/api/user/financial-years/${a}`);const n=d.filter((c,r)=>r!==j);h(n),console.log("Deleted financial year at index",j),alert("Deleted financial year at index",j)}catch(a){console.error("Error deleting financial year:",a)}finally{p(!1)}},y=(a,n)=>{var c;if(a.key==="Enter"){a.preventDefault();const r=(c=n.current)==null?void 0:c.nextElementSibling;r?r.focus():E(a)}};return e.jsxs(N,{sx:{maxWidth:"100%",padding:2},children:[e.jsx(u,{variant:"contained",color:"secondary",onClick:B,children:i!==null?"Edit Financial Year":"Add Financial Year"}),e.jsxs(S,{open:W,onClose:v,children:[e.jsx(R,{style:{backgroundColor:"#f9dff5"},children:i!==null?"Edit Financial Year":"Add Financial Year"}),e.jsx(w,{style:{backgroundColor:"#f9dff5"},children:e.jsx(I,{sx:{padding:"10px",backgroundColor:"#f9dff5"},elevation:0,children:e.jsxs("form",{children:[e.jsx(g,{fullWidth:!0,label:"Financial Year Start Date",name:"start_date",type:"date",InputLabelProps:{shrink:!0},value:t.start_date,onChange:m,margin:"normal",required:!0,inputRef:$,onKeyDown:a=>y(a,Y)}),e.jsx(g,{fullWidth:!0,label:"Financial Year End Date",name:"end_date",type:"date",InputLabelProps:{shrink:!0},value:t.end_date,onChange:m,margin:"normal",required:!0,inputRef:Y,onKeyDown:a=>y(a,b)}),e.jsxs(z,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(H,{children:"Status"}),e.jsxs(J,{value:t.status,name:"status",onChange:m,label:"Status",inputRef:b,onKeyDown:a=>y(a,F),children:[e.jsx(A,{value:!0,children:"Active"}),e.jsx(A,{value:!1,children:"Inactive"})]})]}),e.jsx(g,{fullWidth:!0,label:"Financial Year Name",name:"financial_year_name",value:t.financial_year_name,InputProps:{readOnly:!0},margin:"normal"}),e.jsx(g,{fullWidth:!0,multiline:!0,rows:3,label:"Description",name:"description",value:t.description,onChange:m,margin:"normal",inputRef:F,onKeyDown:a=>y(a,null)})]})})}),e.jsxs(T,{style:{backgroundColor:"#f9dff5"},children:[e.jsx(u,{onClick:v,color:"error",children:"Cancel"}),e.jsx(u,{onClick:E,color:"secondary",disabled:o.add,children:o.add?e.jsx(ae,{size:24}):i!==null?"Update":"Add"})]})]}),e.jsx(Q,{component:I,sx:{marginTop:3},children:e.jsxs(V,{children:[e.jsx(X,{children:e.jsxs(L,{children:[e.jsx(s,{children:"Financial Year Name"}),e.jsx(s,{children:"Start Date"}),e.jsx(s,{children:"End Date"}),e.jsx(s,{children:"Status"}),e.jsx(s,{children:"Description"}),e.jsx(s,{children:"Actions"})]})}),e.jsx(Z,{children:d.map((a,n)=>e.jsxs(L,{children:[e.jsx(s,{children:a.financial_year_name}),e.jsx(s,{children:a.start_date}),e.jsx(s,{children:a.end_date}),e.jsx(s,{children:a.status?"Active":"Inactive"})," ",e.jsx(s,{children:a.description}),e.jsxs(s,{children:[e.jsx(O,{color:"secondary",onClick:()=>U(n),children:e.jsx(G,{})}),e.jsx(O,{color:"error",onClick:()=>q(n),children:e.jsx(ee,{})})]})]},n))})]})}),e.jsxs(S,{open:K,onClose:()=>p(!1),children:[e.jsx(R,{children:"Delete Financial Year"}),e.jsx(w,{children:"Are you sure you want to delete this financial year?"}),e.jsxs(T,{children:[e.jsx(u,{onClick:()=>p(!1),color:"secondary",children:"Cancel"}),e.jsx(u,{onClick:M,color:"error",children:"Confirm"})]})]})]})}export{se as default};
