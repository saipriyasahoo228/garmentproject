import{r as a,j as e,S as Y,U as m,V as v,W,X as N,Y as B,Z as t,_ as d,$ as P,a0 as Z,a1 as J,a2 as Q,a3 as _,a4 as r,a5 as ee,a6 as $,a7 as se,a8 as ne}from"./index-Ctj1838j.js";import{a as j}from"./auth-DxPXTuxr.js";import{C as K}from"./CircularProgress-CZGOoSHl.js";function te(){const[l,p]=a.useState({company_name:"",gst:"",phone:"",email:"",address:""}),[c,C]=a.useState([]),[h,o]=a.useState({add:!1,fetch:!1,delete:!1}),[L,f]=a.useState(!1),[x,D]=a.useState(null),[O,G]=a.useState(null),[I,g]=a.useState(!1),U=a.useRef(null),b=a.useRef(null),R=a.useRef(null),A=a.useRef(null),E=a.useRef(null),w=a.useRef(null),k=async()=>{o(s=>({...s,fetch:!0}));try{const s=await j.get("/api/user/companies");console.log("Fetched Company List Response:",s.data),C(Array.isArray(s.data.data)?s.data.data:[])}catch(s){console.error("Error fetching companies:",s)}finally{o(s=>({...s,fetch:!1}))}};a.useEffect(()=>{k()},[]);const i=s=>{p({...l,[s.target.name]:s.target.value})},q=()=>{f(!0),D(null)},S=()=>{f(!1)},z=async s=>{s.preventDefault(),o(n=>({...n,add:!0}));try{if(x!==null){const n=await j.put(`/api/user/companies/${l.gst}/`,l);alert(n.data.message||"Company updated successfully")}else{const n=await j.post("/api/user/companies/",l);alert(n.data.message||"Company added successfully")}await k()}catch(n){if(console.error("Error adding/updating company:",n),n.response&&n.response.data&&n.response.data.error){const y=n.response.data.error;let T="";for(const[M,X]of Object.entries(y))T+=`${M.toUpperCase()}: ${X.join(", ")}
`;alert(`Validation Errors:
${T}`)}else n.message?alert(`Error: ${n.message}`):alert("An unknown error occurred.")}finally{o(n=>({...n,add:!1})),p({company_name:"",pan:"",gst:"",phone:"",email:"",address:""}),f(!1)}},F=s=>{p(c[s]),D(s),f(!0)},V=s=>{G(s),p(c[s]),g(!0)},H=async()=>{o(s=>({...s,delete:!0})),console.log("GST for deletion:",l.gst);try{if(!l.gst){console.error("GST value is missing.");return}await j.delete(`/api/user/companies/${l.gst}/`);const s=c.filter((n,y)=>y!==O);C(s),console.log("Company deleted successfully!"),alert("Company deleted successfully!")}catch(s){console.error("Error deleting company",s)}finally{o(s=>({...s,delete:!1})),g(!1)}},u=(s,n)=>{s.key==="Enter"&&n.current.focus()};return e.jsxs(Y,{sx:{maxWidth:"100%",padding:2},children:[e.jsx(m,{variant:"contained",color:"secondary",onClick:q,children:x!==null?"Edit Company":"Add Company"}),e.jsxs(v,{open:L,onClose:S,maxWidth:"md",fullWidth:!0,children:[e.jsx(W,{style:{backgroundColor:"#f9dff5"},children:x!==null?"Edit Company Details":"Add Company Details"}),e.jsx(N,{style:{backgroundColor:"#f9dff5"},children:e.jsx(B,{sx:{padding:"10px",backgroundColor:"#f9dff5"},elevation:0,children:e.jsxs("form",{children:[e.jsxs(t,{container:!0,spacing:2,marginBottom:2,children:[e.jsx(t,{item:!0,xs:6,children:e.jsx(d,{fullWidth:!0,label:"Company Name",name:"company_name",value:l.company_name,onChange:i,margin:"normal",required:!0,inputRef:U,onKeyDown:s=>u(s,b)})}),e.jsx(t,{item:!0,xs:6,children:e.jsx(d,{fullWidth:!0,label:"Company Registration Number/GST Number",name:"gst",value:l.gst,onChange:i,margin:"normal",required:!0,inputRef:b,onKeyDown:s=>u(s,R)})})]}),e.jsxs(t,{container:!0,spacing:2,marginBottom:2,children:[e.jsx(t,{item:!0,xs:6,children:e.jsx(d,{fullWidth:!0,label:"PAN Number",name:"pan",value:l.pan,onChange:i,margin:"normal",required:!0,inputRef:R,onKeyDown:s=>u(s,A)})}),e.jsx(t,{item:!0,xs:6,children:e.jsx(d,{fullWidth:!0,label:"Phone Number",name:"phone",value:l.phone,onChange:i,margin:"normal",inputRef:A,onKeyDown:s=>u(s,E)})})]}),e.jsxs(t,{container:!0,spacing:2,marginBottom:2,children:[e.jsx(t,{item:!0,xs:6,children:e.jsx(d,{fullWidth:!0,label:"Email",name:"email",value:l.email,onChange:i,margin:"normal",inputRef:E,onKeyDown:s=>u(s,w)})}),e.jsx(t,{item:!0,xs:6,children:e.jsx(d,{fullWidth:!0,multiline:!0,rows:4,label:"Address",name:"address",value:l.address,onChange:i,margin:"normal",inputRef:w})})]})]})})}),e.jsxs(P,{style:{backgroundColor:"#f9dff5"},children:[e.jsx(m,{onClick:S,color:"error",children:"Cancel"}),e.jsx(m,{onClick:z,color:"secondary",disabled:h.add,children:h.add?e.jsx(K,{size:24}):x!==null?"Update":"Add"})]})]}),e.jsx(Z,{component:B,sx:{marginTop:3},children:e.jsxs(J,{children:[e.jsx(Q,{children:e.jsxs(_,{children:[e.jsx(r,{children:"Company Name"}),e.jsx(r,{children:"GST"}),e.jsx(r,{children:"Phone"}),e.jsx(r,{children:"PAN"}),e.jsx(r,{children:"Email"}),e.jsx(r,{children:"Address"}),e.jsx(r,{children:"Actions"})]})}),e.jsx(ee,{children:Array.isArray(c)&&c.map((s,n)=>e.jsxs(_,{children:[e.jsx(r,{children:s.company_name}),e.jsx(r,{children:s.gst}),e.jsx(r,{children:s.phone}),e.jsx(r,{children:s.pan}),e.jsx(r,{children:s.email}),e.jsx(r,{children:s.address}),e.jsxs(r,{children:[e.jsx($,{color:"secondary",onClick:()=>F(n),children:e.jsx(se,{})}),e.jsx($,{color:"error",onClick:()=>V(n),children:e.jsx(ne,{})})]})]},n))})]})}),e.jsxs(v,{open:I,onClose:()=>g(!1),children:[e.jsx(W,{children:"Confirm Delete"}),e.jsx(N,{children:"Are you sure you want to delete this company?"}),e.jsxs(P,{children:[e.jsx(m,{onClick:()=>g(!1),color:"secondary",children:"Cancel"}),e.jsx(m,{onClick:H,color:"error",disabled:h.delete,children:h.delete?e.jsx(K,{size:24}):"Confirm"})]})]})]})}export{te as default};
