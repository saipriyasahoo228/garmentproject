import{a5 as F,j as e,r as o,J as re,K as h,M as T,O as R,Q as B,S as L,V as c,a6 as M,a7 as O,a8 as N,a9 as P,a1 as D,W as U,X as ne,Y as $,Z as Q,_ as C,$ as n,a0 as Y,a2 as oe,a3 as le}from"./index-IJTRt1jI.js";import{a as m}from"./auth-DxPXTuxr.js";import{C as ie}from"./CircularProgress-Ve5gyilg.js";const ce=F(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m5 11h-4v4h-2v-4H7v-2h4V7h2v4h4z"}),"AddCircle"),de=F(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m5 11H7v-2h10z"}),"RemoveCircle");function ge(){const[r,l]=o.useState({item_name:"",item_code:"",category_name:"",sub_category_name:"",hsn_code:"",unit_price:"",stock_quantity:"",description:"",sizes:[]}),[i,p]=o.useState([]),[_,K]=o.useState([]),[b,V]=o.useState([]),[g,z]=o.useState({add:!1}),[J,k]=o.useState(!1),[d,I]=o.useState(null),[X,Z]=o.useState(null),[G,f]=o.useState(!1),v=o.useRef([]);o.useEffect(()=>{const t=async()=>{try{const a=await m.get("/api/user/items/");p(a.data.data)}catch(a){console.error("Error fetching items:",a)}},s=async()=>{try{const a=await m.get("/api/user/categories/");K(a.data)}catch(a){console.error("Error fetching categories:",a)}};t(),s()},[]);const A=async t=>{t.preventDefault(),z({...g,add:!0});try{if(d!==null){const s=await m.put(`/api/user/items/${r.item_code}/`,r),a=[...i];a[d]={...i[d],...r},p(a),alert(s.data.message)}else{const s=await m.post("/api/user/items-post/",r);p([...i,s.data]),alert(s.data.message)}}catch(s){console.error("Error adding/updating item:",s),alert("Error adding/updating item:",s)}finally{z({...g,add:!1}),j()}},E=async t=>{const s=t.target.value;l({...r,category_name:s,sub_category_name:""});try{const a=await m.get(`/api/user/subcategories/${s}/`);V(a.data)}catch(a){console.error("Error fetching subcategories:",a)}},u=t=>{l({...r,[t.target.name]:t.target.value})},ee=()=>{k(!0),I(null),l({item_name:"",item_code:"",category_name:"",sub_category_name:"",hsn_code:"",unit_price:"",stock_quantity:"",description:"",sizes:[]})},j=()=>{k(!1)},W=()=>{l(t=>({...t,sizes:[...t.sizes,{size:"",unit_price:"",stock_quantity:""}]}))},w=t=>{l(s=>({...s,sizes:s.sizes.filter((a,x)=>x!==t)}))},te=t=>{I(t),l(i[t]),k(!0)},q=t=>{Z(t),f(!0),l(i[t])},se=async()=>{try{await m.delete(`/api/user/items/${r.item_code}/`),p(i.filter((t,s)=>s!==X)),alert("Item deleted successfully!")}catch(t){console.error("Error deleting item:",t)}finally{f(!1)}},ae=(t,s)=>{if(t.key==="Enter"){t.preventDefault();const a=s+1;v.current[a]&&v.current[a].focus()}},y=(t,s,a)=>{const{value:x}=t.target;l(H=>{const S=[...H.sizes];return S[s]={...S[s],[a]:x},{...H,sizes:S}})};return e.jsxs(re,{sx:{maxWidth:"100%",padding:2},children:[e.jsx(h,{variant:"contained",color:"secondary",onClick:ee,children:"Add Item"}),e.jsxs(T,{open:J,onClose:j,handleClose:j,editIndex:d,itemDetails:r,categories:_,subCategories:b,handleCategoryChange:E,handleChange:u,handleDeleteDialogOpen:q,handleAddOrUpdate:A,loading:g,fieldRefs:v,handleKeyDown:ae,handleSizeChange:y,addSize:W,removeSize:w,children:[e.jsx(R,{style:{backgroundColor:"#f9dff5"},children:d!==null?"Edit Item Details":"Add Item Details"}),e.jsx(B,{style:{backgroundColor:"#f9dff5"},children:e.jsx(L,{sx:{padding:"10px",backgroundColor:"#f9dff5"},elevation:0,children:e.jsxs("form",{children:[e.jsx(c,{fullWidth:!0,label:"Item Name",name:"item_name",value:r.item_name,onChange:u,margin:"normal"}),e.jsx(c,{fullWidth:!0,label:"Item Code",name:"item_code",value:r.item_code,onChange:u,margin:"normal"}),e.jsxs(M,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(O,{children:"Category"}),e.jsx(N,{value:r.category_item,name:"category_item",onChange:E,children:Array.isArray(_)&&_.map(t=>e.jsx(P,{value:t.category_name,children:t.category_name},t.id))})]}),e.jsxs(M,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(O,{children:"Sub-Category"}),e.jsx(N,{value:r.sub_category_name,name:"sub_category_name",onChange:u,label:"Sub-Category",disabled:!r.category_name,children:Array.isArray(b)&&b.map(t=>e.jsx(P,{value:t.name,children:t.name},t.id))})]}),e.jsx(c,{fullWidth:!0,label:"HSN Code",name:"hsn_code",value:r.hsn_code,onChange:u,margin:"normal"}),e.jsx(c,{fullWidth:!0,label:"Description",name:"description",value:r.description,onChange:u,margin:"normal"}),r.sizes.map((t,s)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(c,{fullWidth:!0,label:"Size",name:"size",value:t.size,onChange:a=>y(a,s,"size"),margin:"normal"}),e.jsx(c,{fullWidth:!0,label:"Unit Price",name:"unit_price",type:"number",value:t.unit_price,onChange:a=>y(a,s,"unit_price"),margin:"normal"}),e.jsx(c,{fullWidth:!0,label:"Stock Quantity",name:"stock_quantity",type:"number",value:t.stock_quantity,onChange:a=>y(a,s,"stock_quantity"),margin:"normal"}),e.jsx(D,{color:"secondary",onClick:()=>w(s),children:e.jsx(de,{})})]},s)),e.jsx(h,{variant:"outlined",startIcon:e.jsx(ce,{}),onClick:W,children:"Add Size"})]})})}),e.jsxs(U,{style:{backgroundColor:"#f9dff5"},children:[e.jsx(h,{onClick:j,color:"error",children:"Cancel"}),e.jsx(h,{onClick:A,color:"secondary",disabled:g.add,children:g.add?e.jsx(ie,{size:24}):d!==null?"Update":"Add"})]})]}),e.jsx(ne,{component:L,sx:{marginTop:3,boxShadow:3,borderRadius:2,maxHeight:400,overflowY:"auto",scrollbarWidth:"thin",scrollbarColor:"#888 #f1f1f1"},children:e.jsxs($,{stickyHeader:!0,children:[e.jsx(Q,{sx:{backgroundColor:"#e0f7fa"},children:e.jsx(C,{children:["Item Name","Item Code","Category","Sub-Category","HSN Code","Stock details (size,price & quantities)","Description","Actions"].map(t=>e.jsx(n,{sx:{fontWeight:"bold"},children:t},t))})}),e.jsx(Y,{children:Array.isArray(i)&&i.map((t,s)=>e.jsxs(C,{children:[e.jsx(n,{children:t.item_name}),e.jsx(n,{children:t.item_code}),e.jsx(n,{children:t.category_item}),e.jsx(n,{children:t.sub_category}),e.jsx(n,{children:t.hsn_code}),e.jsx(n,{children:e.jsx("div",{style:{maxHeight:"100px",overflowY:"auto",scrollbarWidth:"thin",scrollbarColor:"#888 #f1f1f1"},children:e.jsxs($,{size:"small",stickyHeader:!0,children:[e.jsx(Q,{children:e.jsxs(C,{style:{backgroundColor:"#DDA0DD",position:"sticky",top:0,zIndex:1},children:[e.jsx(n,{sx:{color:"purple"},children:"Size"}),e.jsx(n,{sx:{color:"purple"},children:"Unit Price"}),e.jsx(n,{sx:{color:"purple"},children:"Stock Quantity"})]})}),e.jsx(Y,{children:t.sizes.map((a,x)=>e.jsxs(C,{children:[e.jsx(n,{children:a.size}),e.jsx(n,{children:a.unit_price}),e.jsx(n,{children:a.stock_quantity})]},x))})]})})}),e.jsx(n,{children:t.description}),e.jsxs(n,{children:[e.jsx(D,{color:"secondary",onClick:()=>te(s),children:e.jsx(oe,{})}),e.jsx(D,{color:"error",onClick:()=>q(s),children:e.jsx(le,{})}),e.jsxs(T,{open:G,onClose:()=>f(!1),children:[e.jsx(R,{children:"Confirm Delete"}),e.jsxs(B,{children:["Are you sure you want to delete ",r==null?void 0:r.item_name,"?"]}),e.jsxs(U,{children:[e.jsx(h,{onClick:()=>f(!1),color:"primary",children:"Cancel"}),e.jsx(h,{onClick:se,color:"error",children:"Delete"})]})]})]})]},s))})]})})]})}export{ge as default};
