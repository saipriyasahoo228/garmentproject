import{r as n,j as e,S as M,U as i,V as E,W as S,X as T,Y as O,_ as h,$ as k,a0 as V,a1 as X,a2 as Y,a3 as L,a4 as s,a5 as G,a6 as N,a7 as J,a8 as Q,a9 as Z}from"./index-Ctj1838j.js";import{a as p}from"./auth-DxPXTuxr.js";import{C as I}from"./CircularProgress-CZGOoSHl.js";function re(){const[l,d]=n.useState({category_name:"",category_code:"",sub_category_name:{},description:""}),[x,u]=n.useState([]),[_,f]=n.useState({add:!1,fetch:!0}),[W,g]=n.useState(!1),[y,j]=n.useState(null),[B,C]=n.useState(!1),[K,U]=n.useState(null),F=n.useRef(null),D=n.useRef(null),v=n.useRef(null),w=n.useRef(null);n.useEffect(()=>{(async()=>{try{const t=(await p.get("/api/user/categories/")).data.reduce((o,c)=>(o[c.category_code]={...c,sub_category_name:c.sub_category_name??[]},o),{});u(t)}catch(r){console.error("Fetch error:",r)}finally{f(r=>({...r,fetch:!1}))}})()},[]);const m=a=>{d({...l,[a.target.name]:a.target.value})},P=()=>{g(!0),j(null),d({category_name:"",category_code:"",sub_category_name:"",description:""})},R=()=>{g(!1)},$=a=>{d({category_name:a.category_name||"",category_code:a.category_code||"",sub_category_name:Array.isArray(a.sub_category_name)?a.sub_category_name.map(r=>r.name).join(", "):"",description:a.description||""}),j(a.category_code),g(!0)},q=async a=>{a.preventDefault(),f(t=>({...t,add:!0}));const r={...l,sub_category_name:l.sub_category_name.split(",").map(t=>({name:t.trim()}))};try{if(y!==null){const t=await p.put(`/api/user/categories/${l.category_name}/`,r);u(o=>({...o,[l.category_code]:t.data.data})),alert(t.data.message),j(null)}else{const t=await p.post("/api/user/categories/",r);u(o=>({...o,[t.data.data.category_code]:t.data.data})),alert(t.data.message)}}catch(t){console.error("Error saving category:",t)}finally{f(t=>({...t,add:!1})),d({category_name:"",category_code:"",sub_category_name:"",description:""}),g(!1)}},z=a=>{C(!0),U(a)},H=async()=>{try{const a=x[K];if(!a){console.error("Error: Category not found for deletion.");return}await p.delete(`/api/user/categories/${a.category_name}/`);const t=Object.values(x).filter(o=>o.category_code!==a.category_code).reduce((o,c)=>(o[c.category_code]=c,o),{});u(t),alert("Category deleted successfully!")}catch(a){console.error("Error deleting category:",a)}finally{C(!1)}},A=()=>{C(!1)},b=(a,r)=>{a.key==="Enter"&&r.current&&(a.preventDefault(),r.current.focus())};return e.jsxs(M,{sx:{maxWidth:"100%",padding:2},children:[e.jsx(i,{variant:"contained",color:"secondary",onClick:P,children:y!==null?"Edit Category":"Add Category"}),e.jsxs(E,{open:W,onClose:R,children:[e.jsx(S,{children:y!==null?"Edit Category Details":"Add Category Details"}),e.jsx(T,{children:e.jsx(O,{sx:{padding:"10px"},elevation:0,children:e.jsxs("form",{children:[e.jsx(h,{fullWidth:!0,label:"Category Name",name:"category_name",value:l.category_name,onChange:m,onKeyDown:a=>b(a,D),inputRef:F,margin:"normal",required:!0}),e.jsx(h,{fullWidth:!0,label:"Category Code",name:"category_code",value:l.category_code,onChange:m,onKeyDown:a=>b(a,v),inputRef:D,margin:"normal",required:!0}),e.jsx(h,{fullWidth:!0,label:"Sub-Category Names ",name:"sub_category_name",value:l.sub_category_name,onChange:m,onKeyDown:a=>b(a,w),inputRef:v,margin:"normal"}),e.jsx(h,{fullWidth:!0,multiline:!0,rows:4,label:"Description",name:"description",value:l.description,onChange:m,inputRef:w,margin:"normal"})]})})}),e.jsxs(k,{children:[e.jsx(i,{onClick:R,color:"error",children:"Cancel"}),e.jsx(i,{onClick:q,color:"secondary",disabled:_.add,children:_.add?e.jsx(I,{size:24}):y!==null?"Update":"Add"})]})]}),_.fetch?e.jsx(I,{}):e.jsx(V,{component:O,sx:{marginTop:3},children:e.jsxs(X,{children:[e.jsx(Y,{children:e.jsxs(L,{children:[e.jsx(s,{children:"Category Name"}),e.jsx(s,{children:"Category Code"}),e.jsx(s,{children:"Sub-Category Names"}),e.jsx(s,{children:"Description"}),e.jsx(s,{children:"Actions"})]})}),e.jsx(G,{children:Object.values(x).map(a=>e.jsxs(L,{children:[e.jsx(s,{children:a.category_name}),e.jsx(s,{children:a.category_code}),e.jsx(s,{style:{width:"350px",overflow:"hidden",textOverflow:"ellipsis"},children:Array.isArray(a.sub_category_name)&&a.sub_category_name.length>0?a.sub_category_name.map(r=>(r==null?void 0:r.name)||"Unnamed Subcategory").join(", "):"No Subcategories"}),e.jsx(s,{children:a.description}),e.jsxs(s,{children:[e.jsx(N,{color:"secondary",onClick:()=>$(a),children:e.jsx(J,{})}),e.jsx(N,{color:"error",onClick:()=>z(a.category_code),children:e.jsx(Q,{})})]})]},a.category_code))})]})}),e.jsxs(E,{open:B,onClose:A,children:[e.jsx(S,{children:"Confirm Delete"}),e.jsx(T,{children:e.jsx(Z,{children:"Are you sure you want to delete this category?"})}),e.jsxs(k,{children:[e.jsx(i,{onClick:A,color:"secondary",children:"CANCEL"}),e.jsx(i,{onClick:H,color:"error",children:"CONFIRM"})]})]})]})}export{re as default};
