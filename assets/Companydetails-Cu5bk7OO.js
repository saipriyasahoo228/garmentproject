import{r as a,j as e,J,K as h,M as T,O as v,Q as W,S as L,U as t,V as u,W as N,X as Q,Y as X,Z as Y,_ as B,$ as r,a0 as Z,a1 as K,a2 as ee,a3 as se}from"./index-CZfVeE_g.js";import{a as C}from"./auth-DZlOdSqG.js";import{C as O}from"./CircularProgress-D6MEJcG9.js";function le(){const[l,f]=a.useState({company_name:"",gst:"",phone:"",email:"",address:""}),[i,x]=a.useState([]),[g,d]=a.useState({add:!1,fetch:!1,delete:!1}),[P,j]=a.useState(!1),[m,D]=a.useState(null),[_,$]=a.useState(null),[G,y]=a.useState(!1),I=a.useRef(null),b=a.useRef(null),R=a.useRef(null),A=a.useRef(null),E=a.useRef(null),k=a.useRef(null);a.useEffect(()=>{(async()=>{d(n=>({...n,fetch:!0}));try{const n=await C.get("/api/user/companies");console.log("Fetched Company List Response:",n.data),alert("Fetched Company List Response:",n.data),x(Array.isArray(n.data.data)?n.data.data:[])}catch(n){console.error("Error fetching companies:",n)}finally{d(n=>({...n,fetch:!1}))}})()},[]);const c=s=>{f({...l,[s.target.name]:s.target.value})},U=()=>{j(!0),D(null)},w=()=>{j(!1)},q=async s=>{s.preventDefault(),d(n=>({...n,add:!0}));try{if(m!==null){const n=await C.put(`/api/user/companies/${l.gst}/`,l),o=[...i];o[m]=n.data,x(o),alert(n.data.message||"Company updated successfully")}else{const n=await C.post("/api/user/companies/",l);x(o=>[...o,n.data]),alert(n.data.message||"Company added successfully")}}catch(n){if(console.error("Error adding/updating company:",n),n.response&&n.response.data&&n.response.data.error){const o=n.response.data.error;let S="";for(const[V,H]of Object.entries(o))S+=`${V.toUpperCase()}: ${H.join(", ")}
`;alert(`Validation Errors:
${S}`)}else n.message?alert(`Error: ${n.message}`):alert("An unknown error occurred.")}finally{d(n=>({...n,add:!1})),f({company_name:"",pan:"",gst:"",phone:"",email:"",address:""}),j(!1)}},F=s=>{f(i[s]),D(s),j(!0)},z=s=>{$(s),f(i[s]),y(!0)},M=async()=>{d(s=>({...s,delete:!0})),console.log("GST for deletion:",l.gst);try{if(!l.gst){console.error("GST value is missing.");return}await C.delete(`/api/user/companies/${l.gst}/`);const s=i.filter((n,o)=>o!==_);x(s),console.log("Company deleted successfully!"),alert("Company deleted successfully!")}catch(s){console.error("Error deleting company",s)}finally{d(s=>({...s,delete:!1})),y(!1)}},p=(s,n)=>{s.key==="Enter"&&n.current.focus()};return e.jsxs(J,{sx:{maxWidth:"100%",padding:2},children:[e.jsx(h,{variant:"contained",color:"secondary",onClick:U,children:m!==null?"Edit Company":"Add Company"}),e.jsxs(T,{open:P,onClose:w,maxWidth:"md",fullWidth:!0,children:[e.jsx(v,{style:{backgroundColor:"#f9dff5"},children:m!==null?"Edit Company Details":"Add Company Details"}),e.jsx(W,{style:{backgroundColor:"#f9dff5"},children:e.jsx(L,{sx:{padding:"10px",backgroundColor:"#f9dff5"},elevation:0,children:e.jsxs("form",{children:[e.jsxs(t,{container:!0,spacing:2,marginBottom:2,children:[e.jsx(t,{item:!0,xs:6,children:e.jsx(u,{fullWidth:!0,label:"Company Name",name:"company_name",value:l.company_name,onChange:c,margin:"normal",required:!0,inputRef:I,onKeyDown:s=>p(s,b)})}),e.jsx(t,{item:!0,xs:6,children:e.jsx(u,{fullWidth:!0,label:"Company Registration Number/GST Number",name:"gst",value:l.gst,onChange:c,margin:"normal",required:!0,inputRef:b,onKeyDown:s=>p(s,R)})})]}),e.jsxs(t,{container:!0,spacing:2,marginBottom:2,children:[e.jsx(t,{item:!0,xs:6,children:e.jsx(u,{fullWidth:!0,label:"PAN Number",name:"pan",value:l.pan,onChange:c,margin:"normal",required:!0,inputRef:R,onKeyDown:s=>p(s,A)})}),e.jsx(t,{item:!0,xs:6,children:e.jsx(u,{fullWidth:!0,label:"Phone Number",name:"phone",value:l.phone,onChange:c,margin:"normal",inputRef:A,onKeyDown:s=>p(s,E)})})]}),e.jsxs(t,{container:!0,spacing:2,marginBottom:2,children:[e.jsx(t,{item:!0,xs:6,children:e.jsx(u,{fullWidth:!0,label:"Email",name:"email",value:l.email,onChange:c,margin:"normal",inputRef:E,onKeyDown:s=>p(s,k)})}),e.jsx(t,{item:!0,xs:6,children:e.jsx(u,{fullWidth:!0,multiline:!0,rows:4,label:"Address",name:"address",value:l.address,onChange:c,margin:"normal",inputRef:k})})]})]})})}),e.jsxs(N,{style:{backgroundColor:"#f9dff5"},children:[e.jsx(h,{onClick:w,color:"error",children:"Cancel"}),e.jsx(h,{onClick:q,color:"secondary",disabled:g.add,children:g.add?e.jsx(O,{size:24}):m!==null?"Update":"Add"})]})]}),e.jsx(Q,{component:L,sx:{marginTop:3},children:e.jsxs(X,{children:[e.jsx(Y,{children:e.jsxs(B,{children:[e.jsx(r,{children:"Company Name"}),e.jsx(r,{children:"GST"}),e.jsx(r,{children:"Phone"}),e.jsx(r,{children:"PAN"}),e.jsx(r,{children:"Email"}),e.jsx(r,{children:"Address"}),e.jsx(r,{children:"Actions"})]})}),e.jsx(Z,{children:Array.isArray(i)&&i.map((s,n)=>e.jsxs(B,{children:[e.jsx(r,{children:s.company_name}),e.jsx(r,{children:s.gst}),e.jsx(r,{children:s.phone}),e.jsx(r,{children:s.pan}),e.jsx(r,{children:s.email}),e.jsx(r,{children:s.address}),e.jsxs(r,{children:[e.jsx(K,{color:"secondary",onClick:()=>F(n),children:e.jsx(ee,{})}),e.jsx(K,{color:"error",onClick:()=>z(n),children:e.jsx(se,{})})]})]},n))})]})}),e.jsxs(T,{open:G,onClose:()=>y(!1),children:[e.jsx(v,{children:"Confirm Delete"}),e.jsx(W,{children:"Are you sure you want to delete this company?"}),e.jsxs(N,{children:[e.jsx(h,{onClick:()=>y(!1),color:"secondary",children:"Cancel"}),e.jsx(h,{onClick:M,color:"error",disabled:g.delete,children:g.delete?e.jsx(O,{size:24}):"Confirm"})]})]})]})}export{le as default};
