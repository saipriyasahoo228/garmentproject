import{r as n,j as e,V as H,W as i,X as S,Y as k,Z as E,_ as T,a0 as p,a1 as O,a2 as V,a3 as X,a4 as Z,a5 as N,a6 as l,a7 as G,a8 as L,a9 as J,aa as Q,ab as ee,M as _}from"./index-2oI7w0HU.js";import"./jspdf.plugin.autotable-DsWaxdmh.js";import{D as ae}from"./Download-Ca7JEVS2.js";import{C as I}from"./CircularProgress-CVrM3Oia.js";function se(){const[c,d]=n.useState({category_name:"",category_code:"",sub_category_name:{},description:""}),[u,g]=n.useState([]),[x,f]=n.useState({add:!1,fetch:!0}),[F,y]=n.useState(!1),[m,j]=n.useState(null),[P,C]=n.useState(!1),[W,B]=n.useState(null),K=n.useRef(null),D=n.useRef(null),v=n.useRef(null),w=n.useRef(null);n.useEffect(()=>{(async()=>{try{const t=(await _.get("/api/user/categories/")).data.reduce((r,s)=>(r[s.category_code]={...s,sub_category_name:s.sub_category_name??[]},r),{});g(t)}catch(o){console.error("Fetch error:",o)}finally{f(o=>({...o,fetch:!1}))}})()},[]);const h=a=>{d({...c,[a.target.name]:a.target.value})},U=()=>{y(!0),j(null),d({category_name:"",category_code:"",sub_category_name:"",description:""})},A=()=>{y(!1)},q=a=>{d({category_name:a.category_name||"",category_code:a.category_code||"",sub_category_name:Array.isArray(a.sub_category_name)?a.sub_category_name.map(o=>o.name).join(", "):"",description:a.description||""}),j(a.category_code),y(!0)},M=async a=>{a.preventDefault(),f(t=>({...t,add:!0}));const o={...c,sub_category_name:c.sub_category_name.split(",").map(t=>({name:t.trim()}))};try{if(m!==null){const t=await _.put(`/api/user/categories/${c.category_name}/`,o);g(r=>({...r,[c.category_code]:t.data.data})),alert(t.data.message),j(null)}else{const t=await _.post("/api/user/categories/",o);g(r=>({...r,[t.data.data.category_code]:t.data.data})),alert(t.data.message)}}catch(t){console.error("Error saving category:",t)}finally{f(t=>({...t,add:!1})),d({category_name:"",category_code:"",sub_category_name:"",description:""}),y(!1)}},Y=a=>{C(!0),B(a)},$=async()=>{try{const a=u[W];if(!a){console.error("Error: Category not found for deletion.");return}await _.delete(`/api/user/categories/${a.category_name}/`);const t=Object.values(u).filter(r=>r.category_code!==a.category_code).reduce((r,s)=>(r[s.category_code]=s,r),{});g(t),alert("Category deleted successfully!")}catch(a){console.error("Error deleting category:",a)}finally{C(!1)}},R=()=>{C(!1)},b=(a,o)=>{a.key==="Enter"&&o.current&&(a.preventDefault(),o.current.focus())},z=()=>{const a=new jsPDF;a.text("Category List",14,15);const o=["Category Name","Category Code","Sub-Category Names","Description"],t=Object.values(u).map(r=>[r.category_name,r.category_code,Array.isArray(r.sub_category_name)&&r.sub_category_name.length>0?r.sub_category_name.map(s=>(s==null?void 0:s.name)||"Unnamed Subcategory").join(", "):"No Subcategories",r.description]);a.autoTable({head:[o],body:t,startY:25}),a.save("category_list.pdf")};return e.jsxs(H,{sx:{maxWidth:"100%",padding:2},children:[e.jsx(i,{variant:"contained",startIcon:e.jsx(ae,{}),onClick:z,sx:{position:"absolute",right:20,top:75,backgroundColor:"purple","&:hover":{backgroundColor:"darkviolet"}},children:"Download PDF"}),e.jsx(i,{variant:"contained",color:"secondary",onClick:U,children:m!==null?"Edit Category":"Add Category"}),e.jsxs(S,{open:F,onClose:A,children:[e.jsx(k,{children:m!==null?"Edit Category Details":"Add Category Details"}),e.jsx(E,{children:e.jsx(T,{sx:{padding:"10px"},elevation:0,children:e.jsxs("form",{children:[e.jsx(p,{fullWidth:!0,label:"Category Name",name:"category_name",value:c.category_name,onChange:h,onKeyDown:a=>b(a,D),inputRef:K,margin:"normal",required:!0}),e.jsx(p,{fullWidth:!0,label:"Category Code",name:"category_code",value:c.category_code,onChange:h,onKeyDown:a=>b(a,v),inputRef:D,margin:"normal",required:!0}),e.jsx(p,{fullWidth:!0,label:"Sub-Category Names ",name:"sub_category_name",value:c.sub_category_name,onChange:h,onKeyDown:a=>b(a,w),inputRef:v,margin:"normal"}),e.jsx(p,{fullWidth:!0,multiline:!0,rows:4,label:"Description",name:"description",value:c.description,onChange:h,inputRef:w,margin:"normal"})]})})}),e.jsxs(O,{children:[e.jsx(i,{onClick:A,color:"error",children:"Cancel"}),e.jsx(i,{onClick:M,color:"secondary",disabled:x.add,children:x.add?e.jsx(I,{size:24}):m!==null?"Update":"Add"})]})]}),x.fetch?e.jsx(I,{}):e.jsx(V,{component:T,sx:{marginTop:3},children:e.jsxs(X,{children:[e.jsx(Z,{children:e.jsxs(N,{children:[e.jsx(l,{children:"Category Name"}),e.jsx(l,{children:"Category Code"}),e.jsx(l,{children:"Sub-Category Names"}),e.jsx(l,{children:"Description"}),e.jsx(l,{children:"Actions"})]})}),e.jsx(G,{children:Object.values(u).map(a=>e.jsxs(N,{children:[e.jsx(l,{children:a.category_name}),e.jsx(l,{children:a.category_code}),e.jsx(l,{style:{width:"350px",overflow:"hidden",textOverflow:"ellipsis"},children:Array.isArray(a.sub_category_name)&&a.sub_category_name.length>0?a.sub_category_name.map(o=>(o==null?void 0:o.name)||"Unnamed Subcategory").join(", "):"No Subcategories"}),e.jsx(l,{children:a.description}),e.jsxs(l,{children:[e.jsx(L,{color:"secondary",onClick:()=>q(a),children:e.jsx(J,{})}),e.jsx(L,{color:"error",onClick:()=>Y(a.category_code),children:e.jsx(Q,{})})]})]},a.category_code))})]})}),e.jsxs(S,{open:P,onClose:R,children:[e.jsx(k,{children:"Confirm Delete"}),e.jsx(E,{children:e.jsx(ee,{children:"Are you sure you want to delete this category?"})}),e.jsxs(O,{children:[e.jsx(i,{onClick:R,color:"secondary",children:"CANCEL"}),e.jsx(i,{onClick:$,color:"error",children:"CONFIRM"})]})]})]})}export{se as default};
