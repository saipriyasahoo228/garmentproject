import{r as n,j as e,V as X,W as m,X as T,Y as S,Z as N,_ as P,$ as i,a0 as p,a1 as W,a2 as Z,a3 as J,a4 as Q,a5 as L,a6 as r,a7 as ee,a8 as _,a9 as se,aa as ae,M as b}from"./index-2oI7w0HU.js";import{E as ne}from"./jspdf.plugin.autotable-DsWaxdmh.js";import{D as re}from"./Download-Ca7JEVS2.js";import{C as B}from"./CircularProgress-CVrM3Oia.js";function de(){const[o,x]=n.useState({company_name:"",gst:"",phone:"",email:"",address:""}),[d,g]=n.useState([]),[j,c]=n.useState({add:!1,fetch:!1,delete:!1}),[$,y]=n.useState(!1),[h,D]=n.useState(null),[G,I]=n.useState(null),[K,C]=n.useState(!1),O=n.useRef(null),R=n.useRef(null),w=n.useRef(null),k=n.useRef(null),A=n.useRef(null),E=n.useRef(null);n.useEffect(()=>{(async()=>{c(a=>({...a,fetch:!0}));try{const a=await b.get("/api/user/companies");console.log("Fetched Company List Response:",a.data),g(Array.isArray(a.data.data)?a.data.data:[])}catch(a){console.error("Error fetching companies:",a)}finally{c(a=>({...a,fetch:!1}))}})()},[]);const u=s=>{x({...o,[s.target.name]:s.target.value})},F=()=>{y(!0),D(null)},v=()=>{y(!1)},q=async s=>{s.preventDefault(),c(a=>({...a,add:!0}));try{if(h!==null){const a=await b.put(`/api/user/companies/${o.gst}/`,o),l=[...d];l[h]=a.data,g(l),alert(a.data.message||"Company updated successfully")}else{const a=await b.post("/api/user/companies/",o);g(l=>[...l,a.data]),alert(a.data.message||"Company added successfully")}}catch(a){if(console.error("Error adding/updating company:",a),a.response&&a.response.data&&a.response.data.error){const l=a.response.data.error;let t="";for(const[Y,H]of Object.entries(l))t+=`${Y.toUpperCase()}: ${H.join(", ")}
`;alert(`Validation Errors:
${t}`)}else a.message?alert(`Error: ${a.message}`):alert("An unknown error occurred.")}finally{c(a=>({...a,add:!1})),x({company_name:"",pan:"",gst:"",phone:"",email:"",address:""}),y(!1)}},U=s=>{x(d[s]),D(s),y(!0)},z=s=>{I(s),x(d[s]),C(!0)},M=async()=>{c(s=>({...s,delete:!0})),console.log("GST for deletion:",o.gst);try{if(!o.gst){console.error("GST value is missing.");return}await b.delete(`/api/user/companies/${o.gst}/`);const s=d.filter((a,l)=>l!==G);g(s),console.log("Company deleted successfully!"),alert("Company deleted successfully!")}catch(s){console.error("Error deleting company",s)}finally{c(s=>({...s,delete:!1})),C(!1)}},f=(s,a)=>{s.key==="Enter"&&a.current.focus()},V=()=>{const s=new ne;s.text("Company List",14,15);const a=["Company Name","GST","Phone","PAN","Email","Address"],l=d.map(t=>[t.company_name,t.gst,t.phone,t.pan,t.email,t.address]);s.autoTable({head:[a],body:l,startY:20}),s.save("company_list.pdf")};return e.jsxs(X,{sx:{maxWidth:"100%",padding:2},children:[e.jsx(m,{variant:"contained",color:"primary",startIcon:e.jsx(re,{}),onClick:V,sx:{position:"absolute",right:16,top:75,backgroundColor:"purple","&:hover":{backgroundColor:"darkviolet"}},children:"Download PDF"}),e.jsx(m,{variant:"contained",color:"secondary",onClick:F,children:h!==null?"Edit Company":"Add Company"}),e.jsxs(T,{open:$,onClose:v,maxWidth:"md",fullWidth:!0,children:[e.jsx(S,{style:{backgroundColor:"#f9dff5"},children:h!==null?"Edit Company Details":"Add Company Details"}),e.jsx(N,{style:{backgroundColor:"#f9dff5"},children:e.jsx(P,{sx:{padding:"10px",backgroundColor:"#f9dff5"},elevation:0,children:e.jsxs("form",{children:[e.jsxs(i,{container:!0,spacing:2,marginBottom:2,children:[e.jsx(i,{item:!0,xs:6,children:e.jsx(p,{fullWidth:!0,label:"Company Name",name:"company_name",value:o.company_name,onChange:u,margin:"normal",required:!0,inputRef:O,onKeyDown:s=>f(s,R)})}),e.jsx(i,{item:!0,xs:6,children:e.jsx(p,{fullWidth:!0,label:"Company Registration Number/GST Number",name:"gst",value:o.gst,onChange:u,margin:"normal",required:!0,inputRef:R,onKeyDown:s=>f(s,w)})})]}),e.jsxs(i,{container:!0,spacing:2,marginBottom:2,children:[e.jsx(i,{item:!0,xs:6,children:e.jsx(p,{fullWidth:!0,label:"PAN Number",name:"pan",value:o.pan,onChange:u,margin:"normal",required:!0,inputRef:w,onKeyDown:s=>f(s,k)})}),e.jsx(i,{item:!0,xs:6,children:e.jsx(p,{fullWidth:!0,label:"Phone Number",name:"phone",value:o.phone,onChange:u,margin:"normal",inputRef:k,onKeyDown:s=>f(s,A)})})]}),e.jsxs(i,{container:!0,spacing:2,marginBottom:2,children:[e.jsx(i,{item:!0,xs:6,children:e.jsx(p,{fullWidth:!0,label:"Email",name:"email",value:o.email,onChange:u,margin:"normal",inputRef:A,onKeyDown:s=>f(s,E)})}),e.jsx(i,{item:!0,xs:6,children:e.jsx(p,{fullWidth:!0,multiline:!0,rows:4,label:"Address",name:"address",value:o.address,onChange:u,margin:"normal",inputRef:E})})]})]})})}),e.jsxs(W,{style:{backgroundColor:"#f9dff5"},children:[e.jsx(m,{onClick:v,color:"error",children:"Cancel"}),e.jsx(m,{onClick:q,color:"secondary",disabled:j.add,children:j.add?e.jsx(B,{size:24}):h!==null?"Update":"Add"})]})]}),e.jsx(Z,{component:P,sx:{marginTop:3},children:e.jsxs(J,{children:[e.jsx(Q,{children:e.jsxs(L,{children:[e.jsx(r,{children:"Company Name"}),e.jsx(r,{children:"GST"}),e.jsx(r,{children:"Phone"}),e.jsx(r,{children:"PAN"}),e.jsx(r,{children:"Email"}),e.jsx(r,{children:"Address"}),e.jsx(r,{children:"Actions"})]})}),e.jsx(ee,{children:Array.isArray(d)&&d.map((s,a)=>e.jsxs(L,{children:[e.jsx(r,{children:s.company_name}),e.jsx(r,{children:s.gst}),e.jsx(r,{children:s.phone}),e.jsx(r,{children:s.pan}),e.jsx(r,{children:s.email}),e.jsx(r,{children:s.address}),e.jsxs(r,{children:[e.jsx(_,{color:"secondary",onClick:()=>U(a),children:e.jsx(se,{})}),e.jsx(_,{color:"error",onClick:()=>z(a),children:e.jsx(ae,{})})]})]},a))})]})}),e.jsxs(T,{open:K,onClose:()=>C(!1),children:[e.jsx(S,{children:"Confirm Delete"}),e.jsx(N,{children:"Are you sure you want to delete this company?"}),e.jsxs(W,{children:[e.jsx(m,{onClick:()=>C(!1),color:"secondary",children:"Cancel"}),e.jsx(m,{onClick:M,color:"error",disabled:j.delete,children:j.delete?e.jsx(B,{size:24}):"Confirm"})]})]})]})}export{de as default};
