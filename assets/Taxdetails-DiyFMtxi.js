import{r as s,j as e,V as S,W as d,X as v,Y as w,Z as E,_ as A,ad as Y,ae as z,af as H,ag as T,a0 as R,a1 as I,a2 as V,a3 as X,a4 as Z,a5 as L,a6 as o,a7 as J,a8 as P,a9 as Q,aa as ee,M as f}from"./index-2oI7w0HU.js";import{E as te}from"./jspdf.plugin.autotable-DsWaxdmh.js";import{D as ne}from"./Download-Ca7JEVS2.js";import{C as se}from"./CircularProgress-CVrM3Oia.js";function ce(){const[n,p]=s.useState({tax_name:"",tax_percentage:"",description:""}),[r,u]=s.useState([]),[i,x]=s.useState({add:!1}),[G,h]=s.useState(!1),[c,g]=s.useState(null),[m,N]=s.useState(null),[O,j]=s.useState(!1),W=s.useRef(null),y=s.useRef(null),D=s.useRef(null);s.useEffect(()=>{(async()=>{try{x({...i,fetch:!0});const t=await f.get("/api/user/taxes/");u(t.data.data)}catch(t){console.error("Error fetching tax list",t)}finally{x({...i,fetch:!1})}})()},[]);const C=a=>{p({...n,[a.target.name]:a.target.value})},b=(a,t)=>{var l;a.key==="Enter"&&(a.preventDefault(),(l=t.current)==null||l.focus())},B=()=>{h(!0),g(null)},_=()=>{h(!1)},F=async a=>{if(a.preventDefault(),x({...i,add:!0}),!n.tax_name||!n.tax_percentage){alert("Tax Name and Tax Percentage are required."),x({...i,add:!1});return}try{if(c!==null){const t=await f.put(`/api/user/taxes/${r[c].id}/`,n),l=[...r];l[c]=n,u(l),console.log("Updated",n),alert(t.data.message)}else{const t=await f.post("/api/user/taxes/",n);u([...r,t.data]),console.log("Added",n),alert(t.data.message)}p({tax_name:"",tax_percentage:"",description:""}),g(null),h(!1)}catch(t){console.error("Error adding/updating tax",t)}finally{x({...i,add:!1})}},q=a=>{p(r[a]),g(a),h(!0)},K=a=>{N(a),j(!0)},U=async()=>{try{await f.delete(`/api/user/taxes/${r[m].id}`);const a=r.filter((t,l)=>l!==m);u(a),console.log("Deleted tax at index",m),ae%$%$,j(!1)}catch(a){console.error("Error deleting tax",a)}},k=()=>{j(!1)},M=()=>{const a=new te;a.text("Tax List Report",14,15),a.autoTable({startY:25,head:[["#","Tax Name","Tax Percentage","Description"]],body:(Array.isArray(r)?r:[]).map((t,l)=>[l+1,t.tax_name,t.tax_percentage+" %",t.description]),theme:"striped"}),a.save("Tax_List.pdf")};return e.jsxs(S,{sx:{maxWidth:"100%",padding:2},children:[e.jsx(d,{variant:"contained",color:"secondary",onClick:B,children:c!==null?"Edit Tax":"Add Tax"}),e.jsx(S,{sx:{position:"absolute",top:65,right:60},children:e.jsx(d,{variant:"contained",startIcon:e.jsx(ne,{}),onClick:M,sx:{backgroundColor:"#800080",color:"white","&:hover":{backgroundColor:"#6a006a"}},children:"Download PDF"})}),e.jsxs(v,{open:G,onClose:_,children:[e.jsx(w,{style:{backgroundColor:"#f9dff5"},children:c!==null?"Edit Tax Details":"Add Tax Details"}),e.jsx(E,{style:{backgroundColor:"#f9dff5"},children:e.jsx(A,{sx:{padding:"10px",backgroundColor:"#f9dff5"},elevation:0,children:e.jsxs("form",{children:[e.jsxs(Y,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(z,{children:"Tax Name"}),e.jsxs(H,{value:n.tax_name,name:"tax_name",onChange:C,label:"Tax Name",inputRef:W,onKeyDown:a=>b(a,y),children:[e.jsx(T,{value:"CGST",children:"CGST"}),e.jsx(T,{value:"SGST",children:"SGST"}),e.jsx(T,{value:"IGST",children:"IGST"})]})]}),e.jsx(R,{fullWidth:!0,label:"Tax Percentage",name:"tax_percentage",value:n.tax_percentage,onChange:C,margin:"normal",required:!0,inputRef:y,onKeyDown:a=>b(a,D)}),e.jsx(R,{fullWidth:!0,multiline:!0,rows:4,label:"Description",name:"description",value:n.description,onChange:C,margin:"normal",inputRef:D})]})})}),e.jsxs(I,{style:{backgroundColor:"#f9dff5"},children:[e.jsx(d,{onClick:_,color:"error",children:"Cancel"}),e.jsx(d,{onClick:F,color:"secondary",disabled:i.add,children:i.add?e.jsx(se,{size:24}):c!==null?"Update":"Add"})]})]}),e.jsx(V,{component:A,sx:{marginTop:3},children:e.jsxs(X,{children:[e.jsx(Z,{children:e.jsxs(L,{children:[e.jsx(o,{children:"Tax Name"}),e.jsx(o,{children:"Tax Percentage"}),e.jsx(o,{children:"Description"}),e.jsx(o,{children:"Actions"})]})}),e.jsx(J,{children:(Array.isArray(r)?r:[]).map((a,t)=>e.jsxs(L,{children:[e.jsx(o,{children:a.tax_name}),e.jsx(o,{children:a.tax_percentage}),e.jsx(o,{children:a.description}),e.jsxs(o,{children:[e.jsx(P,{color:"secondary",onClick:()=>q(t),children:e.jsx(Q,{})}),e.jsx(P,{color:"error",onClick:()=>K(t),children:e.jsx(ee,{})})]})]},t))})]})}),e.jsxs(v,{open:O,onClose:k,children:[e.jsx(w,{children:"Confirm Delete"}),e.jsx(E,{children:"Are you sure you want to delete this tax entry?"}),e.jsxs(I,{children:[e.jsx(d,{onClick:k,color:"secondary",children:"Cancel"}),e.jsx(d,{onClick:U,color:"error",children:"Confirm"})]})]})]})}export{ce as default};
