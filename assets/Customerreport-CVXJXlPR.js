import{r as n,j as e,S as y,ad as A,J as B,a6 as C,a8 as _,a9 as d,X as D,Y as q,Z as V,_ as S,$ as r,a0 as W}from"./index-IJTRt1jI.js";import{d as Q,T as w,E as I,u as m,w as Y}from"./PictureAsPdf-olqJTBb8.js";import{d as $}from"./Description-C_cdXcru.js";import{a as H}from"./auth-DxPXTuxr.js";import{C as J}from"./Container-DxWLW0oh.js";const G=()=>{const[l,v]=n.useState(""),[x,T]=n.useState(""),[o,g]=n.useState([]),[h,f]=n.useState(0),[u,P]=n.useState(5),[p,k]=n.useState({key:"",direction:""}),F=async t=>{try{const a=await H.post("api/retailsale/customer-report/",{saletype:t});g(a.data)}catch(a){console.error("Error fetching report data:",a)}},i=t=>{let a="ascending";p.key===t&&p.direction==="ascending"&&(a="descending"),k({key:t,direction:a});const s=[...o].sort((j,b)=>j[t]<b[t]?a==="ascending"?-1:1:j[t]>b[t]?a==="ascending"?1:-1:0);g(s)},c=t=>p.key===t?p.direction==="ascending"?" ▲":" ▼":"",E=()=>{if(o.length===0){alert("No data to export");return}const t=new I;t.text("Customer Sales Report",14,10),t.autoTable({head:[["Customer Name","Phone Number","Total Sales","Total Quantity","Average Purchase Value"]],body:o.map(a=>[a.fullname,a.phone_number,parseFloat(a.total_amount).toFixed(2),a.total_quantity,parseFloat(a.average_amount).toFixed(2)]),startY:20}),t.save("customer_sales_report.pdf")},R=()=>{if(o.length===0){alert("No data to export");return}const t=m.json_to_sheet(o.map(s=>({"Customer Name":s.fullname,"Phone Number":s.phone_number,"Total Sales":parseFloat(s.total_amount).toFixed(2),"Total Quantity":s.total_quantity,"Average Purchase Value":parseFloat(s.average_amount).toFixed(2)}))),a=m.book_new();m.book_append_sheet(a,t,"Customer Sales Report"),Y(a,"customer_sales_report.xlsx")},N=t=>{T(t.target.value),t.target.value==="pdf"?E():t.target.value==="excel"&&R()};return n.useEffect(()=>{F(l)},[l]),e.jsx(J,{maxWidth:"lg",sx:{marginTop:4},children:e.jsxs(y,{elevation:3,sx:{padding:4,backgroundColor:"#f9dff5"},children:[e.jsx(A,{variant:"h4",gutterBottom:!0,align:"center",color:"purple",children:"Customer Sales Report"}),e.jsxs(B,{sx:{display:"flex",justifyContent:"space-between",flexWrap:"wrap",gap:2,marginBottom:3},children:[e.jsx(C,{sx:{minWidth:150},children:e.jsxs(_,{value:l,onChange:t=>v(t.target.value),displayEmpty:!0,renderValue:()=>l||"Select Customer Type",children:[e.jsx(d,{value:"",children:e.jsx("em",{children:"All"})}),e.jsx(d,{value:"RetailSale",children:"Retail"}),e.jsx(d,{value:"BulkSale",children:"Bulk"})]})}),e.jsx(C,{sx:{minWidth:150},children:e.jsxs(_,{value:x,onChange:N,displayEmpty:!0,renderValue:()=>x||"Export As",children:[e.jsxs(d,{value:"pdf",children:[e.jsx(Q,{sx:{marginRight:1,color:"red"}}),"PDF"]}),e.jsxs(d,{value:"excel",children:[e.jsx($,{sx:{marginRight:1,color:"green"}}),"Excel"]})]})})]}),o.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(D,{component:y,sx:{marginTop:4,backgroundColor:"#f4c4ec"},children:e.jsxs(q,{children:[e.jsx(V,{children:e.jsxs(S,{children:[e.jsxs(r,{onClick:()=>i("fullname"),sx:{cursor:"pointer",backgroundColor:"#ea8cdb",fontStyle:"bold",color:"purple"},children:[e.jsx("strong",{children:"Customer Name"}),c("fullname")]}),e.jsxs(r,{onClick:()=>i("phone_number"),sx:{cursor:"pointer",backgroundColor:"#ea8cdb",fontStyle:"bold",color:"purple"},children:[e.jsx("strong",{children:"Phone Number"}),c("phone_number")]}),e.jsxs(r,{onClick:()=>i("total_amount"),sx:{cursor:"pointer",backgroundColor:"#ea8cdb",fontStyle:"bold",color:"purple"},children:[e.jsx("strong",{children:"Total Sales Amount"}),c("total_amount")]}),e.jsxs(r,{onClick:()=>i("total_quantity"),sx:{cursor:"pointer",backgroundColor:"#ea8cdb",fontStyle:"bold",color:"purple"},children:[e.jsx("strong",{children:"Total Quantity Purchased"}),c("total_quantity")]}),e.jsxs(r,{onClick:()=>i("average_amount"),sx:{cursor:"pointer",backgroundColor:"#ea8cdb",fontStyle:"bold",color:"purple"},children:[e.jsx("strong",{children:"Average Purchase Value"}),c("average_amount")]})]})}),e.jsx(W,{children:o.slice(h*u,h*u+u).map((t,a)=>e.jsxs(S,{children:[e.jsx(r,{children:t.fullname}),e.jsx(r,{children:t.phone_number}),e.jsx(r,{children:parseFloat(t.total_amount).toFixed(2)}),e.jsx(r,{children:t.total_quantity}),e.jsx(r,{children:parseFloat(t.average_amount).toFixed(2)})]},a))})]})}),e.jsx(w,{component:"div",count:o.length,page:h,onPageChange:(t,a)=>f(a),rowsPerPage:u,onRowsPerPageChange:t=>{P(parseInt(t.target.value,10)),f(0)},rowsPerPageOptions:[5,10,25],sx:{marginTop:2}})]})]})})};export{G as default};
