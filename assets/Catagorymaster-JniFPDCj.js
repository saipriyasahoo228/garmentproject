import{r,j as e,J as M,K as c,M as T,O as k,Q as A,S as O,V as h,W,X as Q,Y as V,Z as X,_ as I,$ as o,a0 as Y,a1 as K,a2 as Z,a3 as G,a4 as ee}from"./index-C51Jbo_c.js";import{a as x}from"./auth-DxPXTuxr.js";import{C as N}from"./CircularProgress-DHkOWL9n.js";function re(){const[s,i]=r.useState({category_name:"",category_code:"",sub_category_name:{},description:""}),[d,u]=r.useState([]),[p,f]=r.useState({add:!1,fetch:!0}),[B,g]=r.useState(!1),[y,_]=r.useState(null),[L,j]=r.useState(!1),[b,P]=r.useState(null),U=r.useRef(null),w=r.useRef(null),v=r.useRef(null),R=r.useRef(null);r.useEffect(()=>{(async()=>{try{const t=(await x.get("/api/user/categories/")).data.reduce((l,D)=>(l[D.category_code]={...D,sub_category_name:D.sub_category_name.map(J=>({sub_category_name:J}))},l),{});u(t)}catch(n){console.error("Fetch error:",n)}finally{f(n=>({...n,fetch:!1}))}})()},[]);const m=a=>{i({...s,[a.target.name]:a.target.value})},$=()=>{g(!0),_(null),i({category_name:"",category_code:"",sub_category_name:"",description:""})},S=()=>{g(!1)},q=a=>{const n=d[a];i({...n,sub_category_name:n.sub_category_name.join(", ")}),_(a),g(!0)},F=async a=>{a.preventDefault(),f(t=>({...t,add:!0}));const n={...s,sub_category_name:s.sub_category_name.split(",").map(t=>({name:t.trim()}))};try{if(y!==null){const t=await x.put(`/api/user/categories/${s.category_name}/`,n);u(l=>({...l,[s.category_code]:t.data.data})),alert(t.data.message),_(null)}else{const t=await x.post("/api/user/categories/",n);u(l=>({...l,[t.data.data.category_code]:t.data.data})),alert(t.data.message)}}catch(t){console.error("Error saving category:",t)}finally{f(t=>({...t,add:!1})),i({category_name:"",category_code:"",sub_category_name:"",description:""}),g(!1)}},z=a=>{j(!0),P(a)},H=async()=>{try{await x.delete(`/api/user/categories/${d[b].category_name}/`);const a=d.filter((n,t)=>t!==b);u(a),alert("Category deleted successfully!")}catch(a){console.error("Error deleting category:",a)}finally{j(!1)}},E=()=>{j(!1)},C=(a,n)=>{a.key==="Enter"&&n.current&&(a.preventDefault(),n.current.focus())};return e.jsxs(M,{sx:{maxWidth:"100%",padding:2},children:[e.jsx(c,{variant:"contained",color:"secondary",onClick:$,children:y!==null?"Edit Category":"Add Category"}),e.jsxs(T,{open:B,onClose:S,children:[e.jsx(k,{children:y!==null?"Edit Category Details":"Add Category Details"}),e.jsx(A,{children:e.jsx(O,{sx:{padding:"10px"},elevation:0,children:e.jsxs("form",{children:[e.jsx(h,{fullWidth:!0,label:"Category Name",name:"category_name",value:s.category_name,onChange:m,onKeyDown:a=>C(a,w),inputRef:U,margin:"normal",required:!0}),e.jsx(h,{fullWidth:!0,label:"Category Code",name:"category_code",value:s.category_code,onChange:m,onKeyDown:a=>C(a,v),inputRef:w,margin:"normal",required:!0}),e.jsx(h,{fullWidth:!0,label:"Sub-Category Names ",name:"sub_category_name",value:s.sub_category_name,onChange:m,onKeyDown:a=>C(a,R),inputRef:v,margin:"normal"}),e.jsx(h,{fullWidth:!0,multiline:!0,rows:4,label:"Description",name:"description",value:s.description,onChange:m,inputRef:R,margin:"normal"})]})})}),e.jsxs(W,{children:[e.jsx(c,{onClick:S,color:"error",children:"Cancel"}),e.jsx(c,{onClick:F,color:"secondary",disabled:p.add,children:p.add?e.jsx(N,{size:24}):y!==null?"Update":"Add"})]})]}),p.fetch?e.jsx(N,{}):e.jsx(Q,{component:O,sx:{marginTop:3},children:e.jsxs(V,{children:[e.jsx(X,{children:e.jsxs(I,{children:[e.jsx(o,{children:"Category Name"}),e.jsx(o,{children:"Category Code"}),e.jsx(o,{children:"Sub-Category Names"}),e.jsx(o,{children:"Description"}),e.jsx(o,{children:"Actions"})]})}),e.jsx(Y,{children:Object.values(d).map(a=>e.jsxs(I,{children:[e.jsx(o,{children:a.category_name}),e.jsx(o,{children:a.category_code}),e.jsx(o,{style:{width:"350px",overflow:"hidden",textOverflow:"ellipsis"},children:Array.isArray(a.sub_category_name)&&a.sub_category_name.length>0?a.sub_category_name.map(n=>{var t;return((t=n==null?void 0:n.sub_category_name)==null?void 0:t.name)||"Unnamed Subcategory"}).join(", "):"No Subcategories"}),e.jsx(o,{children:a.description}),e.jsxs(o,{children:[e.jsx(K,{color:"secondary",onClick:()=>q(a.category_code),children:e.jsx(Z,{})}),e.jsx(K,{color:"error",onClick:()=>z(a.category_code),children:e.jsx(G,{})})]})]},a.category_code))})]})}),e.jsxs(T,{open:L,onClose:E,children:[e.jsx(k,{children:"Confirm Delete"}),e.jsx(A,{children:e.jsx(ee,{children:"Are you sure you want to delete this category?"})}),e.jsxs(W,{children:[e.jsx(c,{onClick:E,color:"secondary",children:"Cancel"}),e.jsx(c,{onClick:H,color:"error",children:"Confirm"})]})]})]})}export{re as default};
