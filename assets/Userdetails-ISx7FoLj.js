import{r as n,j as e,J as Y,K as m,M as S,O as T,Q as N,S as $,U as o,V as u,a5 as Z,a6 as ee,a7 as se,a8 as q,W as I,X as re,Y as ne,Z as ae,_ as O,$ as l,a0 as le,a1 as L,a2 as te,a3 as oe}from"./index-CGq8NEif.js";import{a as C}from"./auth-DZlOdSqG.js";import{C as ie}from"./CircularProgress-CDR7kye4.js";function fe(){const[a,h]=n.useState({user_name:"",fullname:"",email:"",contact_number:"",role:"",password:"",password2:"",description:""}),[c,p]=n.useState([]),[x,j]=n.useState({add:!1}),[P,g]=n.useState(!1),[f,R]=n.useState(null),[B,w]=n.useState(!1),[F,M]=n.useState(null),V=n.useRef(null),U=n.useRef(null),E=n.useRef(null),v=n.useRef(null),k=n.useRef(null),y=n.useRef(null),A=n.useRef(null),_=n.useRef(null);n.useEffect(()=>{(async()=>{j(r=>({...r,fetch:!0}));try{const r=await C.get("api/user/userdetails/");p(r.data)}catch(r){console.error("Error fetching user data:",r)}finally{j(r=>({...r,fetch:!1}))}})()},[]);const i=s=>{h({...a,[s.target.name]:s.target.value})},z=()=>{g(!0),R(null)},K=()=>{g(!1)},G=async s=>{s.preventDefault(),j({...x,add:!0});try{if(f!==null){const r=await C.put(`api/user/userdetails/${a.user_name}/`,a),d=[...c];d[f]=r.data,p(d),console.log("User updated successfully:",r.data),alert("User updated successfully:")}else{const r=await C.post("api/user/userdetails/",a);p([...c,r.data]),console.log("User added successfully:",r.data),alert("User added successfully:")}}catch(r){console.error("Error adding/updating user:",r)}finally{j({...x,add:!1}),h({user_name:"",fullname:"",email:"",contact_number:"",role:"",password:"",password2:"",description:""}),g(!1)}},H=s=>{h(c[s]),R(s),g(!0)},J=s=>{M(s),w(!0)},Q=async s=>{h(c[s]);try{const r=await C.delete(`api/user/userdetails/${a.user_name}/`,a),d=c.filter((D,b)=>b!==F);p(d),console.log("User deleted successfully:",d),alert(`User deleted successfully: ${d}`)}catch(r){if(console.error("Error adding/updating company:",r),r.response&&r.response.data&&r.response.data.error){const d=r.response.data.error;let D="";for(const[b,X]of Object.entries(d))D+=`${b.toUpperCase()}: ${X.join(", ")}
`;alert(`Validation Errors:
${D}`)}else r.message?alert(`Error: ${r.message}`):alert("An unknown error occurred.")}finally{w(!1)}},W=()=>{w(!1)},t=(s,r)=>{s.key==="Enter"&&(s.preventDefault(),r.current&&r.current.focus())};return e.jsxs(Y,{sx:{maxWidth:"100%",padding:2},children:[e.jsx(m,{variant:"contained",color:"secondary",onClick:z,children:f!==null?"Edit User":"Add User"}),e.jsxs(S,{open:P,onClose:K,sx:{"& .MuiDialog-paper":{width:"800px",maxWidth:"none"}},children:[e.jsx(T,{style:{backgroundColor:"#f9dff5"},children:f!==null?"Edit User Details":"Add User Details"}),e.jsx(N,{style:{backgroundColor:"#f9dff5"},children:e.jsx($,{sx:{padding:"10px",backgroundColor:"#f9dff5"},elevation:0,children:e.jsx("form",{children:e.jsxs(o,{container:!0,spacing:1,children:[e.jsx(o,{item:!0,xs:6,children:e.jsx(u,{fullWidth:!0,label:"User Name",name:"user_name",value:a.user_name,onChange:i,margin:"normal",required:!0,inputRef:V,onKeyDown:s=>t(s,U)})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(u,{fullWidth:!0,label:"Full Name",name:"fullname",value:a.fullname,onChange:i,margin:"normal",required:!0,inputRef:U,onKeyDown:s=>t(s,E)})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(u,{fullWidth:!0,label:"Email Address",name:"email",type:"email",value:a.email,onChange:i,margin:"normal",required:!0,inputRef:E,onKeyDown:s=>t(s,v)})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(u,{fullWidth:!0,label:"Contact Number",name:"contact_number",value:a.contact_number,onChange:i,margin:"normal",required:!0,inputRef:v,onKeyDown:s=>t(s,k)})}),e.jsx(o,{item:!0,xs:6,children:e.jsxs(Z,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(ee,{children:"Role"}),e.jsxs(se,{value:a.role,name:"role",onChange:i,label:"Role",inputRef:k,onKeyDown:s=>t(s,y),children:[e.jsx(q,{value:"Admin",onKeyDown:s=>t(s,y),children:" Admin"}),e.jsx(q,{value:"Employee",onKeyDown:s=>t(s,y),children:"Employee"})]})]})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(u,{fullWidth:!0,label:"Password",name:"password",type:"password",value:a.password,onChange:i,margin:"normal",required:!0,inputRef:y,onKeyDown:s=>t(s,A)})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(u,{fullWidth:!0,label:"Password2",name:"password2",type:"password",value:a.password2,onChange:i,margin:"normal",required:!0,inputRef:A,onKeyDown:s=>t(s,_)})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(u,{fullWidth:!0,multiline:!0,rows:3,label:"Description",name:"description",value:a.description,onChange:i,margin:"normal",inputRef:_,onKeyDown:s=>{s.key==="Enter"&&s.preventDefault()}})})]})})})}),e.jsxs(I,{style:{backgroundColor:"#f9dff5"},children:[e.jsx(m,{onClick:K,color:"error",children:"Cancel"}),e.jsx(m,{onClick:G,color:"secondary",disabled:x.add,children:x.add?e.jsx(ie,{size:24}):f!==null?"Update":"Add"})]})]}),e.jsx(re,{component:$,sx:{marginTop:3},children:e.jsxs(ne,{children:[e.jsx(ae,{children:e.jsxs(O,{children:[e.jsx(l,{children:"User Name"}),e.jsx(l,{children:"Full Name"}),e.jsx(l,{children:"Email Address"}),e.jsx(l,{children:"Contact Number"}),e.jsx(l,{children:"Role"}),e.jsx(l,{children:"Actions"})]})}),e.jsx(le,{children:(Array.isArray(c)?c:[]).map((s,r)=>e.jsxs(O,{children:[e.jsx(l,{children:s.user_name}),e.jsx(l,{children:s.fullname}),e.jsx(l,{children:s.email}),e.jsx(l,{children:s.contact_number}),e.jsx(l,{children:s.role}),e.jsxs(l,{children:[e.jsx(L,{color:"secondary",onClick:()=>H(r),children:e.jsx(te,{})}),e.jsx(L,{color:"error",onClick:()=>J(r),children:e.jsx(oe,{})})]})]},r))})]})}),e.jsxs(S,{open:B,onClose:W,children:[e.jsx(T,{children:"Confirm Delete"}),e.jsx(N,{children:"Are you sure you want to delete this user?"}),e.jsxs(I,{children:[e.jsx(m,{onClick:W,color:"secondary",children:"Cancel"}),e.jsx(m,{onClick:Q,color:"error",children:"Confirm"})]})]})]})}export{fe as default};
