import{aa as V,j as e,r as o,S as oe,U as d,V as R,W as B,X as U,Y as L,_ as l,ab as M,ac as N,ad as O,ae as P,a6 as S,$,a0 as ie,a1 as Y,a2 as F,a3 as y,a4 as n,a5 as Q,a7 as le,a8 as ce}from"./index-P1VgnqGH.js";import{a as u}from"./auth-DxPXTuxr.js";import{C as de}from"./CircularProgress-Dl1yEr1B.js";const ue=V(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m5 11h-4v4h-2v-4H7v-2h4V7h2v4h4z"}),"AddCircle"),he=V(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m5 11H7v-2h10z"}),"RemoveCircle");function fe(){const[r,i]=o.useState({item_name:"",item_code:"",category_item:"",sub_category:"",hsn_code:"",unit_price:"",stock_quantity:"",description:"",sizes:[]}),[h,D]=o.useState([]),[C,K]=o.useState([]),[_,X]=o.useState([]),[m,z]=o.useState({add:!1}),[G,b]=o.useState(!1),[x,I]=o.useState(null),[J,Z]=o.useState(null),[ee,f]=o.useState(!1),k=o.useRef([]),A=async()=>{try{const t=await u.get("/api/user/items/");D(t.data.data)}catch(t){console.error("Error fetching items:",t)}},te=async()=>{try{const t=await u.get("/api/user/categories/");K(t.data)}catch(t){console.error("Error fetching categories:",t)}};o.useEffect(()=>{A(),te()},[]);const W=async t=>{t.preventDefault(),z({...m,add:!0});try{if(x!==null){const a=await u.put(`/api/user/items/${r.item_code}/`,r);alert(a.data.message)}else{const a=await u.post("/api/user/items-post/",r);alert(a.data.message)}await A()}catch(a){console.error("Error adding/updating item:",a),alert("Error adding/updating item:",a)}finally{z({...m,add:!1}),p()}},E=async t=>{const a=t.target.value;i({...r,category_name:a,sub_category_name:""});try{const s=await u.get(`/api/user/subcategories/${a}/`);X(s.data)}catch(s){console.error("Error fetching subcategories:",s)}},c=t=>{i({...r,[t.target.name]:t.target.value})},ae=()=>{b(!0),I(null),i({item_name:"",item_code:"",category_name:"",sub_category:"",hsn_code:"",unit_price:"",stock_quantity:"",description:"",sizes:[]})},p=()=>{b(!1)},w=()=>{i(t=>({...t,sizes:[...t.sizes,{size:"",unit_price:"",stock_quantity:""}]}))},q=t=>{i(a=>({...a,sizes:a.sizes.filter((s,g)=>g!==t)}))},se=t=>{I(t),i(h[t]),b(!0)},H=t=>{Z(t),f(!0),i(h[t])},re=async()=>{try{await u.delete(`/api/user/items/${r.item_code}/`),D(h.filter((t,a)=>a!==J)),alert("Item deleted successfully!")}catch(t){console.error("Error deleting item:",t)}finally{f(!1)}},ne=(t,a)=>{if(t.key==="Enter"){t.preventDefault();const s=a+1;k.current[s]&&k.current[s].focus()}},j=(t,a,s)=>{const{value:g}=t.target;i(T=>{const v=[...T.sizes];return v[a]={...v[a],[s]:g},{...T,sizes:v}})};return e.jsxs(oe,{sx:{maxWidth:"100%",padding:2},children:[e.jsx(d,{variant:"contained",color:"secondary",onClick:ae,children:"Add Item"}),e.jsxs(R,{open:G,onClose:p,handleClose:p,editIndex:x,itemDetails:r,categories:C,subCategories:_,handleCategoryChange:E,handleChange:c,handleDeleteDialogOpen:H,handleAddOrUpdate:W,loading:m,fieldRefs:k,handleKeyDown:ne,handleSizeChange:j,addSize:w,removeSize:q,children:[e.jsx(B,{style:{backgroundColor:"#f9dff5"},children:x!==null?"Edit Item Details":"Add Item Details"}),e.jsx(U,{style:{backgroundColor:"#f9dff5"},children:e.jsx(L,{sx:{padding:"10px",backgroundColor:"#f9dff5"},elevation:0,children:e.jsxs("form",{children:[e.jsx(l,{fullWidth:!0,label:"Item Name",name:"item_name",value:r.item_name,onChange:c,margin:"normal"}),e.jsx(l,{fullWidth:!0,label:"Item Code",name:"item_code",value:r.item_code,onChange:c,margin:"normal"}),e.jsxs(M,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(N,{children:"Category"}),e.jsx(O,{value:r.category_item,name:"category_item",onChange:E,children:Array.isArray(C)&&C.map(t=>e.jsx(P,{value:t.category_name,children:t.category_name},t.id))})]}),e.jsxs(M,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(N,{children:"Sub-Category"}),e.jsx(O,{value:r.sub_category,name:"sub_category",onChange:c,label:"Sub-Category",disabled:!r.category_name,children:Array.isArray(_)&&_.map(t=>e.jsx(P,{value:t.name,children:t.name},t.id))})]}),e.jsx(l,{fullWidth:!0,label:"HSN Code",name:"hsn_code",value:r.hsn_code,onChange:c,margin:"normal"}),e.jsx(l,{fullWidth:!0,label:"Description",name:"description",value:r.description,onChange:c,margin:"normal"}),r.sizes.map((t,a)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(l,{fullWidth:!0,label:"Size",name:"size",value:t.size,onChange:s=>j(s,a,"size"),margin:"normal"}),e.jsx(l,{fullWidth:!0,label:"Unit Price",name:"unit_price",type:"number",value:t.unit_price,onChange:s=>j(s,a,"unit_price"),margin:"normal"}),e.jsx(l,{fullWidth:!0,label:"Stock Quantity",name:"stock_quantity",type:"number",value:t.stock_quantity,onChange:s=>j(s,a,"stock_quantity"),margin:"normal"}),e.jsx(S,{color:"secondary",onClick:()=>q(a),children:e.jsx(he,{})})]},a)),e.jsx(d,{variant:"outlined",startIcon:e.jsx(ue,{}),onClick:w,children:"Add Size"})]})})}),e.jsxs($,{style:{backgroundColor:"#f9dff5"},children:[e.jsx(d,{onClick:p,color:"error",children:"Cancel"}),e.jsx(d,{onClick:W,color:"secondary",disabled:m.add,children:m.add?e.jsx(de,{size:24}):x!==null?"Update":"Add"})]})]}),e.jsx(ie,{component:L,sx:{marginTop:3,boxShadow:3,borderRadius:2,maxHeight:400,overflowY:"auto",scrollbarWidth:"thin",scrollbarColor:"#888 #f1f1f1"},children:e.jsxs(Y,{stickyHeader:!0,children:[e.jsx(F,{sx:{backgroundColor:"#e0f7fa"},children:e.jsx(y,{children:["Item Name","Item Code","Category","Sub-Category","HSN Code","Stock details (size,price & quantities)","Description","Actions"].map(t=>e.jsx(n,{sx:{fontWeight:"bold"},children:t},t))})}),e.jsx(Q,{children:Array.isArray(h)&&h.map((t,a)=>e.jsxs(y,{children:[e.jsx(n,{children:t.item_name}),e.jsx(n,{children:t.item_code}),e.jsx(n,{children:t.category_name}),e.jsx(n,{children:t.sub_category}),e.jsx(n,{children:t.hsn_code}),e.jsx(n,{children:e.jsx("div",{style:{maxHeight:"100px",overflowY:"auto",scrollbarWidth:"thin",scrollbarColor:"#888 #f1f1f1"},children:e.jsxs(Y,{size:"small",stickyHeader:!0,children:[e.jsx(F,{children:e.jsxs(y,{style:{backgroundColor:"#DDA0DD",position:"sticky",top:0,zIndex:1},children:[e.jsx(n,{sx:{fontWeight:"bold"},children:"Size"}),e.jsx(n,{sx:{fontWeight:"bold"},children:"Unit Price"}),e.jsx(n,{sx:{fontWeight:"bold"},children:"Stock Quantity"})]})}),e.jsx(Q,{children:t.sizes.map((s,g)=>e.jsxs(y,{children:[e.jsx(n,{children:s.size}),e.jsx(n,{children:s.unit_price}),e.jsx(n,{children:s.stock_quantity})]},g))})]})})}),e.jsx(n,{children:t.description}),e.jsxs(n,{children:[e.jsx(S,{color:"secondary",onClick:()=>se(a),children:e.jsx(le,{})}),e.jsx(S,{color:"error",onClick:()=>H(a),children:e.jsx(ce,{})}),e.jsxs(R,{open:ee,onClose:()=>f(!1),children:[e.jsx(B,{children:"Confirm Delete"}),e.jsxs(U,{children:["Are you sure you want to delete ",r==null?void 0:r.item_name,"?"]}),e.jsxs($,{children:[e.jsx(d,{onClick:()=>f(!1),color:"primary",children:"Cancel"}),e.jsx(d,{onClick:re,color:"error",children:"Delete"})]})]})]})]},a))})]})})]})}export{fe as default};
