import{r as s,j as e,S as k,U as d,V as v,W as w,X as E,Y as A,ab as z,ac as H,ad as M,ae as T,_ as R,$ as I,a0 as V,a1 as X,a2 as J,a3 as L,a4 as l,a5 as Q,a6 as P,a7 as Z,a8 as ee}from"./index-BZMcyf3q.js";import{a as p}from"./auth-DxPXTuxr.js";import{E as te}from"./jspdf.plugin.autotable-C9DfOvjm.js";import{D as ne}from"./Download-CUn2nmwQ.js";import{C as se}from"./CircularProgress-DXBbcDw3.js";function de(){const[n,f]=s.useState({tax_name:"",tax_percentage:"",description:""}),[r,u]=s.useState([]),[i,x]=s.useState({add:!1}),[G,h]=s.useState(!1),[c,m]=s.useState(null),[g,N]=s.useState(null),[O,j]=s.useState(!1),W=s.useRef(null),y=s.useRef(null),D=s.useRef(null);s.useEffect(()=>{(async()=>{try{x({...i,fetch:!0});const t=await p.get("/api/user/taxes/");u(t.data.data)}catch(t){console.error("Error fetching tax list",t)}finally{x({...i,fetch:!1})}})()},[]);const C=a=>{f({...n,[a.target.name]:a.target.value})},b=(a,t)=>{var o;a.key==="Enter"&&(a.preventDefault(),(o=t.current)==null||o.focus())},B=()=>{h(!0),m(null)},S=()=>{h(!1)},F=async a=>{if(a.preventDefault(),x({...i,add:!0}),!n.tax_name||!n.tax_percentage){alert("Tax Name and Tax Percentage are required."),x({...i,add:!1});return}try{if(c!==null){const t=await p.put(`/api/user/taxes/${r[c].id}/`,n),o=[...r];o[c]=n,u(o),console.log("Updated",n),alert(t.data.message)}else{const t=await p.post("/api/user/taxes/",n);u([...r,t.data]),console.log("Added",n),alert(t.data.message)}f({tax_name:"",tax_percentage:"",description:""}),m(null),h(!1)}catch(t){console.error("Error adding/updating tax",t)}finally{x({...i,add:!1})}},U=a=>{f(r[a]),m(a),h(!0)},q=a=>{N(a),j(!0)},K=async()=>{try{await p.delete(`/api/user/taxes/${r[g].id}`);const a=r.filter((t,o)=>o!==g);u(a),console.log("Deleted tax at index",g),ae%$%$,j(!1)}catch(a){console.error("Error deleting tax",a)}},_=()=>{j(!1)},Y=()=>{const a=new te;a.text("Tax List Report",14,15),a.autoTable({startY:25,head:[["#","Tax Name","Tax Percentage","Description"]],body:(Array.isArray(r)?r:[]).map((t,o)=>[o+1,t.tax_name,t.tax_percentage+" %",t.description]),theme:"striped"}),a.save("Tax_List.pdf")};return e.jsxs(k,{sx:{maxWidth:"100%",padding:2},children:[e.jsx(d,{variant:"contained",color:"secondary",onClick:B,children:c!==null?"Edit Tax":"Add Tax"}),e.jsx(k,{sx:{position:"absolute",top:65,right:60},children:e.jsx(d,{variant:"contained",startIcon:e.jsx(ne,{}),onClick:Y,sx:{backgroundColor:"#800080",color:"white","&:hover":{backgroundColor:"#6a006a"}},children:"Download PDF"})}),e.jsxs(v,{open:G,onClose:S,children:[e.jsx(w,{style:{backgroundColor:"#f9dff5"},children:c!==null?"Edit Tax Details":"Add Tax Details"}),e.jsx(E,{style:{backgroundColor:"#f9dff5"},children:e.jsx(A,{sx:{padding:"10px",backgroundColor:"#f9dff5"},elevation:0,children:e.jsxs("form",{children:[e.jsxs(z,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(H,{children:"Tax Name"}),e.jsxs(M,{value:n.tax_name,name:"tax_name",onChange:C,label:"Tax Name",inputRef:W,onKeyDown:a=>b(a,y),children:[e.jsx(T,{value:"CGST",children:"CGST"}),e.jsx(T,{value:"SGST",children:"SGST"}),e.jsx(T,{value:"IGST",children:"IGST"})]})]}),e.jsx(R,{fullWidth:!0,label:"Tax Percentage",name:"tax_percentage",value:n.tax_percentage,onChange:C,margin:"normal",required:!0,inputRef:y,onKeyDown:a=>b(a,D)}),e.jsx(R,{fullWidth:!0,multiline:!0,rows:4,label:"Description",name:"description",value:n.description,onChange:C,margin:"normal",inputRef:D})]})})}),e.jsxs(I,{style:{backgroundColor:"#f9dff5"},children:[e.jsx(d,{onClick:S,color:"error",children:"Cancel"}),e.jsx(d,{onClick:F,color:"secondary",disabled:i.add,children:i.add?e.jsx(se,{size:24}):c!==null?"Update":"Add"})]})]}),e.jsx(V,{component:A,sx:{marginTop:3},children:e.jsxs(X,{children:[e.jsx(J,{children:e.jsxs(L,{children:[e.jsx(l,{children:"Tax Name"}),e.jsx(l,{children:"Tax Percentage"}),e.jsx(l,{children:"Description"}),e.jsx(l,{children:"Actions"})]})}),e.jsx(Q,{children:(Array.isArray(r)?r:[]).map((a,t)=>e.jsxs(L,{children:[e.jsx(l,{children:a.tax_name}),e.jsx(l,{children:a.tax_percentage}),e.jsx(l,{children:a.description}),e.jsxs(l,{children:[e.jsx(P,{color:"secondary",onClick:()=>U(t),children:e.jsx(Z,{})}),e.jsx(P,{color:"error",onClick:()=>q(t),children:e.jsx(ee,{})})]})]},t))})]})}),e.jsxs(v,{open:O,onClose:_,children:[e.jsx(w,{children:"Confirm Delete"}),e.jsx(E,{children:"Are you sure you want to delete this tax entry?"}),e.jsxs(I,{children:[e.jsx(d,{onClick:_,color:"secondary",children:"Cancel"}),e.jsx(d,{onClick:K,color:"error",children:"Confirm"})]})]})]})}export{de as default};
