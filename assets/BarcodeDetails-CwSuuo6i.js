import{r as a,M as c,j as t,V as d,W as m,aj as F,ak as b,ad as S,ae as v,af as y,ag as C,a0 as h,a2 as te,_ as ae,a3 as se,a4 as re,a5 as R,a6 as r,a7 as ne,al as oe}from"./index-2oI7w0HU.js";import{A as ie}from"./Alert-CBYqo2m7.js";function ue(){const[le,L]=a.useState(""),[u,w]=a.useState(""),[g,_]=a.useState(""),[x,k]=a.useState(""),[I,E]=a.useState(""),[o,N]=a.useState(""),[ce,q]=a.useState(""),[P,B]=a.useState([]),[T,l]=a.useState(""),[Q,p]=a.useState(!1),[D,H]=a.useState([]),[O,V]=a.useState([]),[G,J]=a.useState([]),[de,W]=a.useState(!0),[n,M]=a.useState([]),[K,z]=a.useState(!1),[j,$]=a.useState(""),[f,A]=a.useState("");a.useEffect(()=>{c.get("api/barcode/code/").then(e=>{B(e.data.barcodes||[])}).catch(e=>{console.error("Error fetching stock entries:",e)}),c.get("api/user/categories/").then(e=>{H(e.data),W(!1)}).catch(e=>{console.error("Error fetching categories:",e),W(!1)})},[]),a.useEffect(()=>{c.get("api/user/items/").then(e=>{e.data&&e.data.data&&V(e.data.data)}).catch(e=>console.error("Error fetching items:",e))},[]),a.useEffect(()=>{o&&c.get(`api/user/subcategories/${o}`).then(e=>J(e.data)).catch(e=>console.error("Error fetching subcategories:",e))},[o]);const U=(e,s)=>{e.target.checked?M([...n,s]):M(n.filter(i=>i.id!==s.id))},X=()=>{if(n.length===0){l("No items selected for preview.");return}l(""),z(!0)},Y=()=>{if(!u||!j||!g||!x||!o||!f){l("Please fill in all fields.");return}const e={item_name:j,quantity:parseInt(u,10),item_price:parseFloat(I),item_size:g,shop_name:x,category_name:o,sub_category:f};console.log("New entry data:",e),c.post("api/barcode/code/",e).then(s=>{B([...P,s.data]),Z(),alert("Stock entry added successfully!")}).catch(s=>{console.error("Error adding stock entry:",s),alert("Error adding stock entry. Please try again.")})},Z=()=>{$(""),L(""),w(""),_(""),k(""),E(""),N(""),q(""),A(""),l(""),p(!1)},ee=()=>{if(n.length===0){l("Please select items to print.");return}const e=`
      <html>
        <head>
          <title>Barcode Print</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            .barcode { margin: 10px 0; }
            .barcode img { width: 200px; height: auto; }
            .item-name { font-weight: bold; margin-bottom: 10px; }
          </style>
        </head>
        <body>
          <h1>Barcode Preview</h1>
          ${n.map(i=>`
              <div class="barcode">
                <div class="item-name">${i.item_name}</div>
                <img src="data:image/png;base64,${i.barcode_image_base64}" alt="Barcode">
              </div>
            `).join("")}
          <script>
            window.onload = function() {
              window.print();
              window.close();
            };
          <\/script>
        </body>
      </html>
    `,s=window.open("","_blank","width=800,height=600");s.document.open(),s.document.write(e),s.document.close()};return t.jsxs("div",{children:[t.jsxs(d,{sx:{padding:"20px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(m,{onClick:()=>p(!0),variant:"contained",color:"secondary",children:"Add Barcode"}),t.jsxs(d,{children:[t.jsx(m,{onClick:X,variant:"contained",color:"primary",sx:{marginRight:"10px"},children:"Preview"}),t.jsx(m,{onClick:ee,variant:"contained",color:"secondary",children:"Print"})]}),T&&t.jsx(ie,{severity:"error",children:T})]}),t.jsx(F,{open:Q,onClose:()=>p(!1),children:t.jsxs(d,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:700,bgcolor:"#f9dff5",border:"2px solid #000",boxShadow:24,p:4},children:[t.jsx(b,{variant:"h6",children:"Enter Stock Details"}),t.jsxs(S,{fullWidth:!0,margin:"normal",children:[t.jsx(v,{children:"Category"}),t.jsx(y,{value:o,onChange:e=>N(e.target.value),children:D.map(e=>t.jsx(C,{value:e.category_name,children:e.category_name},e.id))})]}),t.jsxs(S,{fullWidth:!0,margin:"normal",children:[t.jsx(v,{children:"Item Name"}),t.jsx(y,{value:j,onChange:e=>$(e.target.value),children:O.map(e=>t.jsx(C,{value:e.item_name,children:e.item_name},e.id))})]}),t.jsxs(S,{fullWidth:!0,margin:"normal",children:[t.jsx(v,{children:"Sub Categories"}),t.jsx(y,{value:f,onChange:e=>A(e.target.value),children:G.map(e=>t.jsx(C,{value:e.name,children:e.name},e.id))})]}),t.jsx(h,{label:"Quantity",type:"number",value:u,onChange:e=>w(e.target.value),margin:"normal",fullWidth:!0}),t.jsx(h,{label:"Item Price",value:I,onChange:e=>E(e.target.value),margin:"normal",fullWidth:!0}),t.jsx(h,{label:"Item Size",value:g,onChange:e=>_(e.target.value),margin:"normal",fullWidth:!0}),t.jsx(h,{label:"Shop Name",value:x,onChange:e=>k(e.target.value),margin:"normal",fullWidth:!0}),t.jsx(m,{onClick:Y,variant:"contained",color:"secondary",sx:{mt:2},children:"Save"})]})}),t.jsx(F,{open:K,onClose:()=>z(!1),children:t.jsxs(d,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:600,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4},children:[t.jsx(b,{variant:"h6",sx:{marginBottom:"20px"},children:"Barcode Preview"}),n.map((e,s)=>t.jsxs(d,{sx:{display:"flex",alignItems:"center",marginBottom:"10px"},children:[t.jsx("img",{src:`data:image/png;base64,${e.barcode_image_base64}`,alt:"Barcode",style:{width:"200px",marginRight:"10px"}}),t.jsx(b,{children:e.item_name})]},s))]})}),t.jsx(te,{component:ae,sx:{marginTop:"20px"},children:t.jsxs(se,{children:[t.jsx(re,{children:t.jsxs(R,{children:[t.jsx(r,{children:"Select"}),t.jsx(r,{children:"SL. No"}),t.jsx(r,{children:"Barcode"}),t.jsx(r,{children:"Item Name"}),t.jsx(r,{children:"Item Size"}),t.jsx(r,{children:"Shop Name"}),t.jsx(r,{children:"Category Name"})]})}),t.jsx(ne,{children:P.map((e,s)=>t.jsxs(R,{children:[t.jsx(r,{children:t.jsx(oe,{onChange:i=>U(i,e),checked:n.includes(e)})}),t.jsx(r,{children:s+1}),t.jsx(r,{children:e.serial_number}),t.jsx(r,{children:e.item_name}),t.jsx(r,{children:e.item_size}),t.jsx(r,{children:e.shop_name}),t.jsx(r,{children:e.category_name})]},e.id))})]})})]})}export{ue as default};
