import{r as l,j as e,V as w,W as c,X as S,Y as R,Z as I,_ as A,a0 as D,ad as H,ae as V,af as X,ag as T,a1 as L,a2 as Z,a3 as G,a4 as J,a5 as P,a6 as s,a7 as Q,a8 as W,a9 as ee,aa as ae,M as _}from"./index-Dy87SfDR.js";import{E as ne}from"./jspdf.plugin.autotable-C2ZUzCt0.js";import{D as te}from"./Download-D2f_Mj5e.js";import{C as le}from"./CircularProgress-DR9kP0Ar.js";function de(){const[t,f]=l.useState({start_date:"",end_date:"",status:!0,financial_year_name:"",description:""}),[o,h]=l.useState([]),[u,y]=l.useState({add:!1}),[O,x]=l.useState(!1),[i,C]=l.useState(null),[K,p]=l.useState(!1),[j,B]=l.useState(null),U=l.useRef(null),F=l.useRef(null),Y=l.useRef(null),b=l.useRef(null);l.useEffect(()=>{if(t.start_date&&t.end_date){const a=new Date(t.start_date).getFullYear(),n=new Date(t.end_date).getFullYear();f({...t,financial_year_name:`${a}-${n}`})}},[t.start_date,t.end_date]),l.useEffect(()=>{(async()=>{try{const n=await _.get("/api/user/financial-years/");h(n.data.data)}catch(n){console.error("Error fetching financial year data:",n)}finally{y({...u,fetch:!1})}})()},[]);const m=a=>{f({...t,[a.target.name]:a.target.value})},$=()=>{x(!0),C(null)},v=()=>{x(!1)},k=async a=>{a.preventDefault(),y({...u,add:!0});const n=i!==null?`/api/user/financial-years/${o[i].id}/`:"/api/user/financial-years/",d=i!==null?"put":"post";try{const r=await _({method:d,url:n,data:t});if(i!==null){const E=[...o];E[i]=r.data.data,h(E)}else h([...o,r.data.data]);console.log(i!==null?"Updated":"Added",r.data),alert(r.data.message),x(!1)}catch(r){console.error("Error saving financial year:",r)}finally{y({...u,add:!1})}f({start_date:"",end_date:"",status:!0,financial_year_name:"",description:""})},q=a=>{f(o[a]),C(a),x(!0)},N=a=>{B(a),p(!0)},M=async()=>{try{const a=o[j].id;await _.delete(`/api/user/financial-years/${a}`);const n=o.filter((d,r)=>r!==j);h(n),console.log("Deleted financial year at index",j),alert("Deleted financial year at index",j)}catch(a){console.error("Error deleting financial year:",a)}finally{p(!1)}},g=(a,n)=>{var d;if(a.key==="Enter"){a.preventDefault();const r=(d=n.current)==null?void 0:d.nextElementSibling;r?r.focus():k(a)}},z=()=>{const a=new ne;a.text("Financial Year Report",14,15),a.autoTable({startY:25,head:[["#","Financial Year Name","Start Date","End Date","Status","Description"]],body:o.map((n,d)=>[d+1,n.financial_year_name,n.start_date,n.end_date,n.status?"Active":"Inactive",n.description]),theme:"striped"}),a.save("Financial_Year_List.pdf")};return e.jsxs(w,{sx:{maxWidth:"100%",padding:2},children:[e.jsx(c,{variant:"contained",color:"secondary",onClick:$,children:i!==null?"Edit Financial Year":"Add Financial Year"}),e.jsx(w,{sx:{position:"absolute",top:65,right:60},children:e.jsx(c,{variant:"contained",startIcon:e.jsx(te,{}),onClick:z,sx:{backgroundColor:"#800080",color:"white","&:hover":{backgroundColor:"#6a006a"}},children:"Download PDF"})}),e.jsxs(S,{open:O,onClose:v,children:[e.jsx(R,{style:{backgroundColor:"#f9dff5"},children:i!==null?"Edit Financial Year":"Add Financial Year"}),e.jsx(I,{style:{backgroundColor:"#f9dff5"},children:e.jsx(A,{sx:{padding:"10px",backgroundColor:"#f9dff5"},elevation:0,children:e.jsxs("form",{children:[e.jsx(D,{fullWidth:!0,label:"Financial Year Start Date",name:"start_date",type:"date",InputLabelProps:{shrink:!0},value:t.start_date,onChange:m,margin:"normal",required:!0,inputRef:U,onKeyDown:a=>g(a,F)}),e.jsx(D,{fullWidth:!0,label:"Financial Year End Date",name:"end_date",type:"date",InputLabelProps:{shrink:!0},value:t.end_date,onChange:m,margin:"normal",required:!0,inputRef:F,onKeyDown:a=>g(a,Y)}),e.jsxs(H,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(V,{children:"Status"}),e.jsxs(X,{value:t.status,name:"status",onChange:m,label:"Status",inputRef:Y,onKeyDown:a=>g(a,b),children:[e.jsx(T,{value:!0,children:"Active"}),e.jsx(T,{value:!1,children:"Inactive"})]})]}),e.jsx(D,{fullWidth:!0,label:"Financial Year Name",name:"financial_year_name",value:t.financial_year_name,InputProps:{readOnly:!0},margin:"normal"}),e.jsx(D,{fullWidth:!0,multiline:!0,rows:3,label:"Description",name:"description",value:t.description,onChange:m,margin:"normal",inputRef:b,onKeyDown:a=>g(a,null)})]})})}),e.jsxs(L,{style:{backgroundColor:"#f9dff5"},children:[e.jsx(c,{onClick:v,color:"error",children:"Cancel"}),e.jsx(c,{onClick:k,color:"secondary",disabled:u.add,children:u.add?e.jsx(le,{size:24}):i!==null?"Update":"Add"})]})]}),e.jsx(Z,{component:A,sx:{marginTop:3},children:e.jsxs(G,{children:[e.jsx(J,{children:e.jsxs(P,{children:[e.jsx(s,{children:"Financial Year Name"}),e.jsx(s,{children:"Start Date"}),e.jsx(s,{children:"End Date"}),e.jsx(s,{children:"Status"}),e.jsx(s,{children:"Description"}),e.jsx(s,{children:"Actions"})]})}),e.jsx(Q,{children:o.map((a,n)=>e.jsxs(P,{children:[e.jsx(s,{children:a.financial_year_name}),e.jsx(s,{children:a.start_date}),e.jsx(s,{children:a.end_date}),e.jsx(s,{children:a.status?"Active":"Inactive"})," ",e.jsx(s,{children:a.description}),e.jsxs(s,{children:[e.jsx(W,{color:"secondary",onClick:()=>q(n),children:e.jsx(ee,{})}),e.jsx(W,{color:"error",onClick:()=>N(n),children:e.jsx(ae,{})})]})]},n))})]})}),e.jsxs(S,{open:K,onClose:()=>p(!1),children:[e.jsx(R,{children:"Delete Financial Year"}),e.jsx(I,{children:"Are you sure you want to delete this financial year?"}),e.jsxs(L,{children:[e.jsx(c,{onClick:()=>p(!1),color:"secondary",children:"Cancel"}),e.jsx(c,{onClick:M,color:"error",children:"Confirm"})]})]})]})}export{de as default};
