import{ac as K,j as e,r as o,V as P,W as c,X as R,Y,Z as L,_ as N,a0 as d,ad as B,ae as M,af as U,ag as F,a8 as D,a1 as O,a2 as le,a3 as Q,a4 as $,a5 as C,a6 as n,a7 as V,a9 as ce,aa as de,M as m}from"./index-Dy87SfDR.js";import{E as ue}from"./jspdf.plugin.autotable-C2ZUzCt0.js";import{D as he}from"./Download-D2f_Mj5e.js";import{C as me}from"./CircularProgress-DR9kP0Ar.js";const ge=K(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m5 11h-4v4h-2v-4H7v-2h4V7h2v4h4z"}),"AddCircle"),xe=K(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m5 11H7v-2h10z"}),"RemoveCircle");function Ce(){const[r,l]=o.useState({item_name:"",item_code:"",category_item:"",sub_category:"",hsn_code:"",unit_price:"",stock_quantity:"",description:"",sizes:[]}),[u,I]=o.useState([]),[_,X]=o.useState([]),[b,Z]=o.useState([]),[g,z]=o.useState({add:!1}),[G,k]=o.useState(!1),[x,w]=o.useState(null),[J,ee]=o.useState(null),[te,p]=o.useState(!1),v=o.useRef([]),A=async()=>{try{const t=await m.get("/api/user/items/");I(t.data.data)}catch(t){console.error("Error fetching items:",t)}},ae=async()=>{try{const t=await m.get("/api/user/categories/");X(t.data)}catch(t){console.error("Error fetching categories:",t)}};o.useEffect(()=>{A(),ae()},[]);const W=async t=>{t.preventDefault(),z({...g,add:!0});try{if(x!==null){const a=await m.put(`/api/user/items/${r.item_code}/`,r);alert(a.data.message)}else{const a=await m.post("/api/user/items-post/",r);alert(a.data.message)}await A()}catch(a){console.error("Error adding/updating item:",a),alert("Error adding/updating item:",a)}finally{z({...g,add:!1}),f()}},E=async t=>{const a=t.target.value;l({...r,category_name:a,sub_category_name:""});try{const s=await m.get(`/api/user/subcategories/${a}/`);Z(s.data)}catch(s){console.error("Error fetching subcategories:",s)}},h=t=>{l({...r,[t.target.name]:t.target.value})},se=()=>{k(!0),w(null),l({item_name:"",item_code:"",category_name:"",sub_category:"",hsn_code:"",unit_price:"",stock_quantity:"",description:"",sizes:[]})},f=()=>{k(!1)},T=()=>{l(t=>({...t,sizes:[...t.sizes,{size:"",unit_price:"",stock_quantity:""}]}))},q=t=>{l(a=>({...a,sizes:a.sizes.filter((s,i)=>i!==t)}))},re=t=>{w(t),l(u[t]),k(!0)},H=t=>{ee(t),p(!0),l(u[t])},ne=async()=>{try{await m.delete(`/api/user/items/${r.item_code}/`),I(u.filter((t,a)=>a!==J)),alert("Item deleted successfully!")}catch(t){console.error("Error deleting item:",t)}finally{p(!1)}},oe=(t,a)=>{if(t.key==="Enter"){t.preventDefault();const s=a+1;v.current[s]&&v.current[s].focus()}},y=(t,a,s)=>{const{value:i}=t.target;l(j=>{const S=[...j.sizes];return S[a]={...S[a],[s]:i},{...j,sizes:S}})},ie=()=>{const t=new ue;t.text("Item List Report",14,15),u.forEach((a,s)=>{t.autoTable({startY:t.autoTable.previous.finalY?t.autoTable.previous.finalY+10:20,head:[["#","Item Name","Item Code","Category","Sub-Category","HSN Code","Description"]],body:[[s+1,a.item_name,a.item_code,a.category_name,a.sub_category,a.hsn_code,a.description]],theme:"striped"}),t.autoTable({startY:t.autoTable.previous.finalY+5,head:[["#","Size","Unit Price","Stock Quantity"]],body:a.sizes.map((i,j)=>[j+1,i.size,i.unit_price,i.stock_quantity]),theme:"grid",styles:{cellPadding:2,fontSize:10}})}),t.save("Item_List.pdf")};return e.jsxs(P,{sx:{maxWidth:"100%",padding:2},children:[e.jsx(c,{variant:"contained",color:"secondary",onClick:se,children:"Add Item"}),e.jsx(P,{sx:{position:"absolute",top:65,right:60},children:e.jsx(c,{variant:"contained",startIcon:e.jsx(he,{}),onClick:ie,sx:{backgroundColor:"#800080",color:"white","&:hover":{backgroundColor:"#6a006a"}},children:"Download PDF"})}),e.jsxs(R,{open:G,onClose:f,handleClose:f,editIndex:x,itemDetails:r,categories:_,subCategories:b,handleCategoryChange:E,handleChange:h,handleDeleteDialogOpen:H,handleAddOrUpdate:W,loading:g,fieldRefs:v,handleKeyDown:oe,handleSizeChange:y,addSize:T,removeSize:q,children:[e.jsx(Y,{style:{backgroundColor:"#f9dff5"},children:x!==null?"Edit Item Details":"Add Item Details"}),e.jsx(L,{style:{backgroundColor:"#f9dff5"},children:e.jsx(N,{sx:{padding:"10px",backgroundColor:"#f9dff5"},elevation:0,children:e.jsxs("form",{children:[e.jsx(d,{fullWidth:!0,label:"Item Name",name:"item_name",value:r.item_name,onChange:h,margin:"normal"}),e.jsx(d,{fullWidth:!0,label:"Item Code",name:"item_code",value:r.item_code,onChange:h,margin:"normal"}),e.jsxs(B,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(M,{children:"Category"}),e.jsx(U,{value:r.category_item,name:"category_item",onChange:E,children:Array.isArray(_)&&_.map(t=>e.jsx(F,{value:t.category_name,children:t.category_name},t.id))})]}),e.jsxs(B,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(M,{children:"Sub-Category"}),e.jsx(U,{value:r.sub_category,name:"sub_category",onChange:h,label:"Sub-Category",disabled:!r.category_name,children:Array.isArray(b)&&b.map(t=>e.jsx(F,{value:t.name,children:t.name},t.id))})]}),e.jsx(d,{fullWidth:!0,label:"HSN Code",name:"hsn_code",value:r.hsn_code,onChange:h,margin:"normal"}),e.jsx(d,{fullWidth:!0,label:"Description",name:"description",value:r.description,onChange:h,margin:"normal"}),r.sizes.map((t,a)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(d,{fullWidth:!0,label:"Size",name:"size",value:t.size,onChange:s=>y(s,a,"size"),margin:"normal"}),e.jsx(d,{fullWidth:!0,label:"Unit Price",name:"unit_price",type:"number",value:t.unit_price,onChange:s=>y(s,a,"unit_price"),margin:"normal"}),e.jsx(d,{fullWidth:!0,label:"Stock Quantity",name:"stock_quantity",type:"number",value:t.stock_quantity,onChange:s=>y(s,a,"stock_quantity"),margin:"normal"}),e.jsx(D,{color:"secondary",onClick:()=>q(a),children:e.jsx(xe,{})})]},a)),e.jsx(c,{variant:"outlined",startIcon:e.jsx(ge,{}),onClick:T,children:"Add Size"})]})})}),e.jsxs(O,{style:{backgroundColor:"#f9dff5"},children:[e.jsx(c,{onClick:f,color:"error",children:"Cancel"}),e.jsx(c,{onClick:W,color:"secondary",disabled:g.add,children:g.add?e.jsx(me,{size:24}):x!==null?"Update":"Add"})]})]}),e.jsx(le,{component:N,sx:{marginTop:3,boxShadow:3,borderRadius:2,maxHeight:400,overflowY:"auto",scrollbarWidth:"thin",scrollbarColor:"#888 #f1f1f1"},children:e.jsxs(Q,{stickyHeader:!0,children:[e.jsx($,{sx:{backgroundColor:"#e0f7fa"},children:e.jsx(C,{children:["Item Name","Item Code","Category","Sub-Category","HSN Code","Stock details (size,price & quantities)","Description","Actions"].map(t=>e.jsx(n,{sx:{fontWeight:"bold"},children:t},t))})}),e.jsx(V,{children:Array.isArray(u)&&u.map((t,a)=>e.jsxs(C,{children:[e.jsx(n,{children:t.item_name}),e.jsx(n,{children:t.item_code}),e.jsx(n,{children:t.category_name}),e.jsx(n,{children:t.sub_category}),e.jsx(n,{children:t.hsn_code}),e.jsx(n,{children:e.jsx("div",{style:{maxHeight:"100px",overflowY:"auto",scrollbarWidth:"thin",scrollbarColor:"#888 #f1f1f1"},children:e.jsxs(Q,{size:"small",stickyHeader:!0,children:[e.jsx($,{children:e.jsxs(C,{style:{backgroundColor:"#DDA0DD",position:"sticky",top:0,zIndex:1},children:[e.jsx(n,{sx:{fontWeight:"bold"},children:"Size"}),e.jsx(n,{sx:{fontWeight:"bold"},children:"Unit Price"}),e.jsx(n,{sx:{fontWeight:"bold"},children:"Stock Quantity"})]})}),e.jsx(V,{children:t.sizes.map((s,i)=>e.jsxs(C,{children:[e.jsx(n,{children:s.size}),e.jsx(n,{children:s.unit_price}),e.jsx(n,{children:s.stock_quantity})]},i))})]})})}),e.jsx(n,{children:t.description}),e.jsxs(n,{children:[e.jsx(D,{color:"secondary",onClick:()=>re(a),children:e.jsx(ce,{})}),e.jsx(D,{color:"error",onClick:()=>H(a),children:e.jsx(de,{})}),e.jsxs(R,{open:te,onClose:()=>p(!1),children:[e.jsx(Y,{children:"Confirm Delete"}),e.jsxs(L,{children:["Are you sure you want to delete ",r==null?void 0:r.item_name,"?"]}),e.jsxs(O,{children:[e.jsx(c,{onClick:()=>p(!1),color:"primary",children:"Cancel"}),e.jsx(c,{onClick:ne,color:"error",children:"Delete"})]})]})]})]},a))})]})})]})}export{Ce as default};
